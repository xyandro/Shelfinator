using System;
using System.Collections.Generic;
using System.Linq;
using System.Windows;
using Shelfinator.Creator.SongData;

namespace Shelfinator.Creator.Songs
{
	class TinyLove : SongCreator
	{
		public override int SongNumber => 9;

		readonly Layout bodyLayout;

		public TinyLove()
		{
			bodyLayout = new Layout("Shelfinator.Creator.Songs.Layout.Layout-Body.png");
		}

		Segment Shift(out int time)
		{
			var segment = new Segment();

			var color = new LightColor(0, 1000, new List<int> { 0x000000 }, new List<int> { 0x101010 }, new List<int> { 0x100000, 0x100800, 0x101000 }, new List<int> { 0x101010, 0x100000, 0x101010 }, new List<int> { 0x000010, 0x001010, 0x000010 });

			var center = new Point(48, 48);
			var lightColor = bodyLayout.GetAllLights().ToDictionary(light => light, light => (((bodyLayout.GetLightPosition(light) - center).Length - 9) * 16.9830463869911).Round());

			time = 0;
			for (var ctr = 0; ctr < 42; ++ctr)
			{
				segment.Clear(time);
				var shift = Math.Max(0, Math.Min(19 - Math.Abs(23 - ctr), 17));
				for (var y = 0; y < 4; ++y)
					for (var x = 0; x < 4; ++x)
					{
						var lights = bodyLayout.GetPositionLights(x * 38 - shift, y * 38, 19, 2);
						lights.AddRange(bodyLayout.GetPositionLights(x * 38 + 2 + shift, y * 38 + 19, 19, 2));
						lights.AddRange(bodyLayout.GetPositionLights(x * 38 + 19, y * 38 - shift, 2, 19));
						lights.AddRange(bodyLayout.GetPositionLights(x * 38, y * 38 + 2 + shift, 2, 19));

						foreach (var light in lights)
							segment.AddLight(light, time, color, lightColor[light]);
					}
				time += 100;
			}
			return segment;
		}

		Segment Runners()
		{
			const int Speed = 15;
			var segment = new Segment();
			var aroundSquare = new Dictionary<int, List<Vector>>
			{
				[76] = new List<Vector> { new Vector(0, 0), new Vector(0, 1), new Vector(0, 2), new Vector(0, 3), new Vector(0, 4), new Vector(0, 5), new Vector(0, 6), new Vector(0, 7), new Vector(0, 8), new Vector(0, 9), new Vector(0, 10), new Vector(0, 11), new Vector(0, 12), new Vector(0, 13), new Vector(0, 14), new Vector(0, 15), new Vector(0, 16), new Vector(0, 17), new Vector(0, 18), new Vector(0, 19), new Vector(1, 19), new Vector(2, 19), new Vector(3, 19), new Vector(4, 19), new Vector(5, 19), new Vector(6, 19), new Vector(7, 19), new Vector(8, 19), new Vector(9, 19), new Vector(10, 19), new Vector(11, 19), new Vector(12, 19), new Vector(13, 19), new Vector(14, 19), new Vector(15, 19), new Vector(16, 19), new Vector(17, 19), new Vector(18, 19), new Vector(19, 19), new Vector(19, 18), new Vector(19, 17), new Vector(19, 16), new Vector(19, 15), new Vector(19, 14), new Vector(19, 13), new Vector(19, 12), new Vector(19, 11), new Vector(19, 10), new Vector(19, 9), new Vector(19, 8), new Vector(19, 7), new Vector(19, 6), new Vector(19, 5), new Vector(19, 4), new Vector(19, 3), new Vector(19, 2), new Vector(19, 1), new Vector(19, 0), new Vector(18, 0), new Vector(17, 0), new Vector(16, 0), new Vector(15, 0), new Vector(14, 0), new Vector(13, 0), new Vector(12, 0), new Vector(11, 0), new Vector(10, 0), new Vector(9, 0), new Vector(8, 0), new Vector(7, 0), new Vector(6, 0), new Vector(5, 0), new Vector(4, 0), new Vector(3, 0), new Vector(2, 0), new Vector(1, 0) },
				[152] = new List<Vector> { new Vector(0, 0), new Vector(0, 1), new Vector(0, 2), new Vector(0, 3), new Vector(0, 4), new Vector(0, 5), new Vector(0, 6), new Vector(0, 7), new Vector(0, 8), new Vector(0, 9), new Vector(0, 10), new Vector(0, 11), new Vector(0, 12), new Vector(0, 13), new Vector(0, 14), new Vector(0, 15), new Vector(0, 16), new Vector(0, 17), new Vector(0, 18), new Vector(0, 19), new Vector(0, 20), new Vector(0, 21), new Vector(0, 22), new Vector(0, 23), new Vector(0, 24), new Vector(0, 25), new Vector(0, 26), new Vector(0, 27), new Vector(0, 28), new Vector(0, 29), new Vector(0, 30), new Vector(0, 31), new Vector(0, 32), new Vector(0, 33), new Vector(0, 34), new Vector(0, 35), new Vector(0, 36), new Vector(0, 37), new Vector(0, 38), new Vector(1, 38), new Vector(2, 38), new Vector(3, 38), new Vector(4, 38), new Vector(5, 38), new Vector(6, 38), new Vector(7, 38), new Vector(8, 38), new Vector(9, 38), new Vector(10, 38), new Vector(11, 38), new Vector(12, 38), new Vector(13, 38), new Vector(14, 38), new Vector(15, 38), new Vector(16, 38), new Vector(17, 38), new Vector(18, 38), new Vector(19, 38), new Vector(20, 38), new Vector(21, 38), new Vector(22, 38), new Vector(23, 38), new Vector(24, 38), new Vector(25, 38), new Vector(26, 38), new Vector(27, 38), new Vector(28, 38), new Vector(29, 38), new Vector(30, 38), new Vector(31, 38), new Vector(32, 38), new Vector(33, 38), new Vector(34, 38), new Vector(35, 38), new Vector(36, 38), new Vector(37, 38), new Vector(38, 38), new Vector(38, 37), new Vector(38, 36), new Vector(38, 35), new Vector(38, 34), new Vector(38, 33), new Vector(38, 32), new Vector(38, 31), new Vector(38, 30), new Vector(38, 29), new Vector(38, 28), new Vector(38, 27), new Vector(38, 26), new Vector(38, 25), new Vector(38, 24), new Vector(38, 23), new Vector(38, 22), new Vector(38, 21), new Vector(38, 20), new Vector(38, 19), new Vector(38, 18), new Vector(38, 17), new Vector(38, 16), new Vector(38, 15), new Vector(38, 14), new Vector(38, 13), new Vector(38, 12), new Vector(38, 11), new Vector(38, 10), new Vector(38, 9), new Vector(38, 8), new Vector(38, 7), new Vector(38, 6), new Vector(38, 5), new Vector(38, 4), new Vector(38, 3), new Vector(38, 2), new Vector(38, 1), new Vector(38, 0), new Vector(37, 0), new Vector(36, 0), new Vector(35, 0), new Vector(34, 0), new Vector(33, 0), new Vector(32, 0), new Vector(31, 0), new Vector(30, 0), new Vector(29, 0), new Vector(28, 0), new Vector(27, 0), new Vector(26, 0), new Vector(25, 0), new Vector(24, 0), new Vector(23, 0), new Vector(22, 0), new Vector(21, 0), new Vector(20, 0), new Vector(19, 0), new Vector(18, 0), new Vector(17, 0), new Vector(16, 0), new Vector(15, 0), new Vector(14, 0), new Vector(13, 0), new Vector(12, 0), new Vector(11, 0), new Vector(10, 0), new Vector(9, 0), new Vector(8, 0), new Vector(7, 0), new Vector(6, 0), new Vector(5, 0), new Vector(4, 0), new Vector(3, 0), new Vector(2, 0), new Vector(1, 0) },
				[228] = new List<Vector> { new Vector(0, 0), new Vector(0, 1), new Vector(0, 2), new Vector(0, 3), new Vector(0, 4), new Vector(0, 5), new Vector(0, 6), new Vector(0, 7), new Vector(0, 8), new Vector(0, 9), new Vector(0, 10), new Vector(0, 11), new Vector(0, 12), new Vector(0, 13), new Vector(0, 14), new Vector(0, 15), new Vector(0, 16), new Vector(0, 17), new Vector(0, 18), new Vector(0, 19), new Vector(0, 20), new Vector(0, 21), new Vector(0, 22), new Vector(0, 23), new Vector(0, 24), new Vector(0, 25), new Vector(0, 26), new Vector(0, 27), new Vector(0, 28), new Vector(0, 29), new Vector(0, 30), new Vector(0, 31), new Vector(0, 32), new Vector(0, 33), new Vector(0, 34), new Vector(0, 35), new Vector(0, 36), new Vector(0, 37), new Vector(0, 38), new Vector(0, 39), new Vector(0, 40), new Vector(0, 41), new Vector(0, 42), new Vector(0, 43), new Vector(0, 44), new Vector(0, 45), new Vector(0, 46), new Vector(0, 47), new Vector(0, 48), new Vector(0, 49), new Vector(0, 50), new Vector(0, 51), new Vector(0, 52), new Vector(0, 53), new Vector(0, 54), new Vector(0, 55), new Vector(0, 56), new Vector(0, 57), new Vector(1, 57), new Vector(2, 57), new Vector(3, 57), new Vector(4, 57), new Vector(5, 57), new Vector(6, 57), new Vector(7, 57), new Vector(8, 57), new Vector(9, 57), new Vector(10, 57), new Vector(11, 57), new Vector(12, 57), new Vector(13, 57), new Vector(14, 57), new Vector(15, 57), new Vector(16, 57), new Vector(17, 57), new Vector(18, 57), new Vector(19, 57), new Vector(20, 57), new Vector(21, 57), new Vector(22, 57), new Vector(23, 57), new Vector(24, 57), new Vector(25, 57), new Vector(26, 57), new Vector(27, 57), new Vector(28, 57), new Vector(29, 57), new Vector(30, 57), new Vector(31, 57), new Vector(32, 57), new Vector(33, 57), new Vector(34, 57), new Vector(35, 57), new Vector(36, 57), new Vector(37, 57), new Vector(38, 57), new Vector(39, 57), new Vector(40, 57), new Vector(41, 57), new Vector(42, 57), new Vector(43, 57), new Vector(44, 57), new Vector(45, 57), new Vector(46, 57), new Vector(47, 57), new Vector(48, 57), new Vector(49, 57), new Vector(50, 57), new Vector(51, 57), new Vector(52, 57), new Vector(53, 57), new Vector(54, 57), new Vector(55, 57), new Vector(56, 57), new Vector(57, 57), new Vector(57, 56), new Vector(57, 55), new Vector(57, 54), new Vector(57, 53), new Vector(57, 52), new Vector(57, 51), new Vector(57, 50), new Vector(57, 49), new Vector(57, 48), new Vector(57, 47), new Vector(57, 46), new Vector(57, 45), new Vector(57, 44), new Vector(57, 43), new Vector(57, 42), new Vector(57, 41), new Vector(57, 40), new Vector(57, 39), new Vector(57, 38), new Vector(57, 37), new Vector(57, 36), new Vector(57, 35), new Vector(57, 34), new Vector(57, 33), new Vector(57, 32), new Vector(57, 31), new Vector(57, 30), new Vector(57, 29), new Vector(57, 28), new Vector(57, 27), new Vector(57, 26), new Vector(57, 25), new Vector(57, 24), new Vector(57, 23), new Vector(57, 22), new Vector(57, 21), new Vector(57, 20), new Vector(57, 19), new Vector(57, 18), new Vector(57, 17), new Vector(57, 16), new Vector(57, 15), new Vector(57, 14), new Vector(57, 13), new Vector(57, 12), new Vector(57, 11), new Vector(57, 10), new Vector(57, 9), new Vector(57, 8), new Vector(57, 7), new Vector(57, 6), new Vector(57, 5), new Vector(57, 4), new Vector(57, 3), new Vector(57, 2), new Vector(57, 1), new Vector(57, 0), new Vector(56, 0), new Vector(55, 0), new Vector(54, 0), new Vector(53, 0), new Vector(52, 0), new Vector(51, 0), new Vector(50, 0), new Vector(49, 0), new Vector(48, 0), new Vector(47, 0), new Vector(46, 0), new Vector(45, 0), new Vector(44, 0), new Vector(43, 0), new Vector(42, 0), new Vector(41, 0), new Vector(40, 0), new Vector(39, 0), new Vector(38, 0), new Vector(37, 0), new Vector(36, 0), new Vector(35, 0), new Vector(34, 0), new Vector(33, 0), new Vector(32, 0), new Vector(31, 0), new Vector(30, 0), new Vector(29, 0), new Vector(28, 0), new Vector(27, 0), new Vector(26, 0), new Vector(25, 0), new Vector(24, 0), new Vector(23, 0), new Vector(22, 0), new Vector(21, 0), new Vector(20, 0), new Vector(19, 0), new Vector(18, 0), new Vector(17, 0), new Vector(16, 0), new Vector(15, 0), new Vector(14, 0), new Vector(13, 0), new Vector(12, 0), new Vector(11, 0), new Vector(10, 0), new Vector(9, 0), new Vector(8, 0), new Vector(7, 0), new Vector(6, 0), new Vector(5, 0), new Vector(4, 0), new Vector(3, 0), new Vector(2, 0), new Vector(1, 0) },
			};
			var useTuples = new Queue<Tuple<Point, int, int>>(new List<Tuple<Point, int, int>> { Tuple.Create(new Point(0, 0), 228, 0), null, Tuple.Create(new Point(38, 38), 228, 0), null, Tuple.Create(new Point(38, 0), 228, 2), null, null, null, Tuple.Create(new Point(0, 38), 228, 2), null, Tuple.Create(new Point(0, 0), 76, 0), null, Tuple.Create(new Point(76, 76), 76, 0), null, Tuple.Create(new Point(76, 0), 76, 0), null, Tuple.Create(new Point(0, 76), 76, 0), null, Tuple.Create(default(Point), 0, 0), null, Tuple.Create(default(Point), 0, 0), null, null, null, Tuple.Create(default(Point), 0, 0), null, Tuple.Create(default(Point), 0, 0), null, Tuple.Create(new Point(0, 0), 152, 0), Tuple.Create(default(Point), 0, 0), Tuple.Create(new Point(57, 57), 152, 2), Tuple.Create(default(Point), 0, 0), Tuple.Create(new Point(57, 0), 152, 3), Tuple.Create(default(Point), 0, 0), Tuple.Create(new Point(0, 57), 152, 1), Tuple.Create(default(Point), 0, 0), Tuple.Create(new Point(19, 19), 228, 0) });
			var lightSize = new Size(2, 2);
			var curTuples = new Queue<Tuple<Point, int, int>>();
			var lightColor = new LightColor(0, 1000, new List<int> { 0x101010 }, new List<int> { 0x100000, 0x100800, 0x101000 }, new List<int> { 0x101010, 0x100000, 0x101010 }, new List<int> { 0x000010, 0x001010, 0x000010 });
			var center = new Point(48, 48);
			var lightDist = bodyLayout.GetAllLights().ToDictionary(light => light, light => (((bodyLayout.GetLightPosition(light) - center).Length - 9) * 16.9830463869911).Round());
			for (var time = 0; time < 4400; time += 5)
			{
				if ((time % 100) == 0)
					if (useTuples.Any())
					{
						var tuple = useTuples.Dequeue();
						if (tuple != null)
						{
							if (tuple.Item2 == 0)
								curTuples.Dequeue();
							else
								curTuples.Enqueue(tuple);
						}
					}

				segment.Clear(time);
				foreach (var tuple in curTuples)
				{
					var points = aroundSquare[tuple.Item2];
					var shift = time / Speed + tuple.Item3;
					for (var around = 0; around < points.Count; ++around)
						if ((around + shift) % 4 == 0)
						{
							var lights = bodyLayout.GetPositionLights(tuple.Item1 + points[around], lightSize);
							foreach (var light in lights)
								segment.AddLight(light, time, lightColor, lightDist[light]);
						}
				}
			}
			return segment;
		}

		class LineStopPoint
		{
			public Point Point { get; set; }
			public Point Dest { get; set; }
			public Vector Direction { get; set; }
			public int Color { get; set; }

			public LineStopPoint(Point point, Point dest, Vector direction, int color)
			{
				Point = point;
				Dest = dest;
				Direction = direction;
				Color = color;
			}
		}

		Segment LineStop()
		{
			var segment = new Segment();
			var lineStopPoints = new List<LineStopPoint>();
			for (var time = 0; time < 970; ++time)
			{
				if (time % 10 == 0)
				{
					for (var y = 0; y < 97; y += 19)
						lineStopPoints.Add(new LineStopPoint(new Point(-1, y), new Point(96 - time / 10, y), new Vector(1, 0), (y % 38 == 0) == (time % 20 == 0) ? 0x101010 : 0x100000));
					for (var y = 1; y < 97; y += 19)
						lineStopPoints.Add(new LineStopPoint(new Point(97, y), new Point(time / 10, y), new Vector(-1, 0), ((y - 1) % 38 == 0) == (time % 20 == 0) ? 0x100000 : 0x101010));
					for (var x = 0; x < 97; x += 19)
						lineStopPoints.Add(new LineStopPoint(new Point(x, -1), new Point(x, 96 - time / 10), new Vector(0, 1), (x % 38 == 0) == (time % 20 == 0) ? 0x101010 : 0x100000));
					for (var x = 1; x < 97; x += 19)
						lineStopPoints.Add(new LineStopPoint(new Point(x, 97), new Point(x, time / 10), new Vector(0, -1), ((x - 1) % 38 == 0) == (time % 20 == 0) ? 0x100000 : 0x101010));
				}

				segment.Clear(time);

				var isDone = new HashSet<int>();
				for (var ctr = 0; ctr < lineStopPoints.Count; ++ctr)
				{
					var lineStopPoint = lineStopPoints[ctr];
					var done = false;
					if (lineStopPoint.Point == lineStopPoint.Dest)
					{
						lineStopPoint.Direction = new Vector(0, 0);
						done = true;
					}

					var newPoint = lineStopPoint.Point + lineStopPoint.Direction;
					var light = bodyLayout.GetPositionLight(newPoint);
					lineStopPoint.Point = newPoint;
					if (!isDone.Contains(light))
						segment.AddLight(light, time, lineStopPoint.Color);
					if (done)
						isDone.Add(light);
				}
			}
			return segment;
		}

		Segment Heart()
		{
			var pixelData =
				"          ██████████                    █████████          /" +
				"        ██████████████                █████████████        /" +
				"       ████████████████             ████████████████       /" +
				"     ███████████████████           ██████████████████      /" +
				"     ████████████████████         ████████████████████     /" +
				"    ██████████████████████       ██████████████████████    /" +
				"   ████████████████████████     ████████████████████████   /" +
				"  █████████████████████████     ████████████████████████   /" +
				"  ██████████████████████████   ██████████████████████████  /" +
				"  ███████████████████████████ ███████████████████████████  /" +
				" ████████████████████████████ ████████████████████████████ /" +
				" █████████████████████████████████████████████████████████ /" +
				"███████████████████████████████████████████████████████████/" +
				"███████████████████████████████████████████████████████████/" +
				"███████████████████████████████████████████████████████████/" +
				"███████████████████████████████████████████████████████████/" +
				"███████████████████████████████████████████████████████████/" +
				"███████████████████████████████████████████████████████████/" +
				"███████████████████████████████████████████████████████████/" +
				"███████████████████████████████████████████████████████████/" +
				"███████████████████████████████████████████████████████████/" +
				"███████████████████████████████████████████████████████████/" +
				"███████████████████████████████████████████████████████████/" +
				"███████████████████████████████████████████████████████████/" +
				"███████████████████████████████████████████████████████████/" +
				"███████████████████████████████████████████████████████████/" +
				"███████████████████████████████████████████████████████████/" +
				"███████████████████████████████████████████████████████████/" +
				" █████████████████████████████████████████████████████████ /" +
				" █████████████████████████████████████████████████████████ /" +
				"  ███████████████████████████████████████████████████████  /" +
				"  ███████████████████████████████████████████████████████  /" +
				"   █████████████████████████████████████████████████████   /" +
				"    ███████████████████████████████████████████████████    /" +
				"    ██████████████████████████████████████████████████     /" +
				"     ████████████████████████████████████████████████      /" +
				"      ██████████████████████████████████████████████       /" +
				"       ████████████████████████████████████████████        /" +
				"         █████████████████████████████████████████         /" +
				"          ███████████████████████████████████████          /" +
				"           ████████████████████████████████████            /" +
				"             █████████████████████████████████             /" +
				"              ███████████████████████████████              /" +
				"                ███████████████████████████                /" +
				"                 █████████████████████████                 /" +
				"                  ███████████████████████                  /" +
				"                   █████████████████████                   /" +
				"                    ███████████████████                    /" +
				"                     █████████████████                     /" +
				"                      ███████████████                      /" +
				"                       █████████████                       /" +
				"                        ███████████                        /" +
				"                         █████████                         /" +
				"                          ███████                          /" +
				"                           ██████                          /" +
				"                           █████                           /" +
				"                            ███                            /" +
				"                            ███                            /" +
				"                             █                             ";

			var pixels = pixelData.Split('/').Select(str => str.Select(c => c != ' ').ToList()).ToList();
			var size = pixels.Count;

			var segment = new Segment();
			var lightColor = new LightColor(0, size, new List<int> { 0x001000, 0x000100 }, new List<int> { 0x000010, 0x000001 }, new List<int> { 0x100000, 0x101010, 0x100000, 0x101010, 0x100000 }, new List<int> { 0x100010, 0x001010, 0x100010, 0x001010, 0x100010 }, Helpers.Rainbow6);
			int x = (97 - size) / 2, y = 0, xOfs = 1, yOfs = 1;
			for (var time = 0; time <= 77; ++time)
			{
				var angle = -(double)time / 77 * 2 * Math.PI;
				var cos = Math.Cos(angle);
				var sin = Math.Sin(angle);

				segment.Clear(time);

				foreach (var light in bodyLayout.GetAllLights())
				{
					var point = bodyLayout.GetLightPosition(light);
					point.X -= x + size / 2;
					point.Y -= y + size / 2;
					var xVal = (point.X * cos - point.Y * sin + size / 2).Round();
					var yVal = (point.X * sin + point.Y * cos + size / 2).Round();
					var usePoint = new Point(xVal, yVal);
					if ((xVal >= 0) && (yVal >= 0) && (xVal < size) && (yVal < size))
						if (pixels[yVal][xVal])
							segment.AddLight(light, time, lightColor, yVal);
				}

				if ((x + xOfs < 0) || (x + size + xOfs > 97))
					xOfs = -xOfs;
				else
					x += xOfs;
				if ((y + yOfs < 0) || (y + size + yOfs > 97))
					yOfs = -yOfs;
				else
					y += yOfs;
			}

			return segment;
		}

		class PointLinesLight
		{
			public Point Current { get; set; }
			public Point? Dest { get; set; }
			public Point Location
			{
				get
				{
					if (!Dest.HasValue)
						return Current;
					return new Point(Percent / 100d * (Dest.Value.X - Current.X) + Current.X, Percent / 100d * (Dest.Value.Y - Current.Y) + Current.Y);
				}
			}
			double percent;
			public int Percent
			{
				get => (percent * 100).Round(); set
				{
					if (value >= 100)
					{
						Current = Dest ?? Current;
						Dest = null;
						percent = 0;
					}
					else
						percent = value / 100d;
				}
			}
			public int Color;

			public PointLinesLight(Point current, int color)
			{
				Current = current;
				Color = color;
			}
		}

		Segment PointLines(out int time)
		{
			const int PointCount = 50;
			const int LoopTime = 100;
			const int MoveTime = 50;
			const int PercentIncrease = 2;
			const string ZonesStr =
				"0,0&1,0&0,1&1,1&0,2&1,2&0,3&1,3&0,4&1,4&0,5&1,5&0,6&1,6&0,7&1,7&0,8&1,8&0,9&1,9&0,10&1,10&0,11&1,11&0,12&1,12&0,13&1,13&0,14&1,14&0,15&1,15&0,16&1,16&0,17&1,17&0,18&1,18&0,19&1,19&0,20&1,20&0,21&1,21&0,22&1,22&0,23&1,23&0,24&1,24&0,25&1,25&0,26&1,26&0,27&1,27&0,28&1,28&0,29&1,29&0,30&1,30&0,31&1,31&0,32&1,32&0,33&1,33&0,34&1,34&0,35&1,35&0,36&1,36&0,37&1,37&0,38&1,38&0,39&1,39&0,40&1,40&0,41&1,41&0,42&1,42&0,43&1,43&0,44&1,44&0,45&1,45&0,46&1,46&0,47&1,47&0,48&1,48&0,49&1,49&0,50&1,50&0,51&1,51&" +
				"0,52&1,52&0,53&1,53&0,54&1,54&0,55&1,55&0,56&1,56&0,57&1,57&0,58&1,58&0,59&1,59&0,60&1,60&0,61&1,61&0,62&1,62&0,63&1,63&0,64&1,64&0,65&1,65&0,66&1,66&0,67&1,67&0,68&1,68&0,69&1,69&0,70&1,70&0,71&1,71&0,72&1,72&0,73&1,73&0,74&1,74&0,75&1,75&0,76&1,76&0,77&1,77&0,78&1,78&0,79&1,79&0,80&1,80&0,81&1,81&0,82&1,82&0,83&1,83&0,84&1,84&0,85&1,85&0,86&1,86&0,87&1,87&0,88&1,88&0,89&1,89&0,90&1,90&0,91&1,91&0,92&1,92&0,93&1,93&0,94&1,94&0,95&1,95&0,96&1,96/19,0&20,0&19,1&20,1&19,2&20,2&19,3&20,3&19,4&20,4&" +
				"19,5&20,5&19,6&20,6&19,7&20,7&19,8&20,8&19,9&20,9&19,10&20,10&19,11&20,11&19,12&20,12&19,13&20,13&19,14&20,14&19,15&20,15&19,16&20,16&19,17&20,17&19,18&20,18&19,19&20,19&19,20&20,20&19,21&20,21&19,22&20,22&19,23&20,23&19,24&20,24&19,25&20,25&19,26&20,26&19,27&20,27&19,28&20,28&19,29&20,29&19,30&20,30&19,31&20,31&19,32&20,32&19,33&20,33&19,34&20,34&19,35&20,35&19,36&20,36&19,37&20,37&19,38&20,38&19,39&20,39&19,40&20,40&19,41&20,41&19,42&20,42&19,43&20,43&19,44&20,44&19,45&20,45&19,46&20,46&19,47&" +
				"20,47&19,48&20,48&19,49&20,49&19,50&20,50&19,51&20,51&19,52&20,52&19,53&20,53&19,54&20,54&19,55&20,55&19,56&20,56&19,57&20,57&19,58&20,58&19,59&20,59&19,60&20,60&19,61&20,61&19,62&20,62&19,63&20,63&19,64&20,64&19,65&20,65&19,66&20,66&19,67&20,67&19,68&20,68&19,69&20,69&19,70&20,70&19,71&20,71&19,72&20,72&19,73&20,73&19,74&20,74&19,75&20,75&19,76&20,76&19,77&20,77&19,78&20,78&19,79&20,79&19,80&20,80&19,81&20,81&19,82&20,82&19,83&20,83&19,84&20,84&19,85&20,85&19,86&20,86&19,87&20,87&19,88&20,88&19" +
				",89&20,89&19,90&20,90&19,91&20,91&19,92&20,92&19,93&20,93&19,94&20,94&19,95&20,95&19,96&20,96/38,0&39,0&38,1&39,1&38,2&39,2&38,3&39,3&38,4&39,4&38,5&39,5&38,6&39,6&38,7&39,7&38,8&39,8&38,9&39,9&38,10&39,10&38,11&39,11&38,12&39,12&38,13&39,13&38,14&39,14&38,15&39,15&38,16&39,16&38,17&39,17&38,18&39,18&38,19&39,19&38,20&39,20&38,21&39,21&38,22&39,22&38,23&39,23&38,24&39,24&38,25&39,25&38,26&39,26&38,27&39,27&38,28&39,28&38,29&39,29&38,30&39,30&38,31&39,31&38,32&39,32&38,33&39,33&38,34&39,34&38,35&" +
				"39,35&38,36&39,36&38,37&39,37&38,38&39,38&38,39&39,39&38,40&39,40&38,41&39,41&38,42&39,42&38,43&39,43&38,44&39,44&38,45&39,45&38,46&39,46&38,47&39,47&38,48&39,48&38,49&39,49&38,50&39,50&38,51&39,51&38,52&39,52&38,53&39,53&38,54&39,54&38,55&39,55&38,56&39,56&38,57&39,57&38,58&39,58&38,59&39,59&38,60&39,60&38,61&39,61&38,62&39,62&38,63&39,63&38,64&39,64&38,65&39,65&38,66&39,66&38,67&39,67&38,68&39,68&38,69&39,69&38,70&39,70&38,71&39,71&38,72&39,72&38,73&39,73&38,74&39,74&38,75&39,75&38,76&39,76&38" +
				",77&39,77&38,78&39,78&38,79&39,79&38,80&39,80&38,81&39,81&38,82&39,82&38,83&39,83&38,84&39,84&38,85&39,85&38,86&39,86&38,87&39,87&38,88&39,88&38,89&39,89&38,90&39,90&38,91&39,91&38,92&39,92&38,93&39,93&38,94&39,94&38,95&39,95&38,96&39,96/57,0&58,0&57,1&58,1&57,2&58,2&57,3&58,3&57,4&58,4&57,5&58,5&57,6&58,6&57,7&58,7&57,8&58,8&57,9&58,9&57,10&58,10&57,11&58,11&57,12&58,12&57,13&58,13&57,14&58,14&57,15&58,15&57,16&58,16&57,17&58,17&57,18&58,18&57,19&58,19&57,20&58,20&57,21&58,21&57,22&58,22&57,23&" +
				"58,23&57,24&58,24&57,25&58,25&57,26&58,26&57,27&58,27&57,28&58,28&57,29&58,29&57,30&58,30&57,31&58,31&57,32&58,32&57,33&58,33&57,34&58,34&57,35&58,35&57,36&58,36&57,37&58,37&57,38&58,38&57,39&58,39&57,40&58,40&57,41&58,41&57,42&58,42&57,43&58,43&57,44&58,44&57,45&58,45&57,46&58,46&57,47&58,47&57,48&58,48&57,49&58,49&57,50&58,50&57,51&58,51&57,52&58,52&57,53&58,53&57,54&58,54&57,55&58,55&57,56&58,56&57,57&58,57&57,58&58,58&57,59&58,59&57,60&58,60&57,61&58,61&57,62&58,62&57,63&58,63&57,64&58,64&57" +
				",65&58,65&57,66&58,66&57,67&58,67&57,68&58,68&57,69&58,69&57,70&58,70&57,71&58,71&57,72&58,72&57,73&58,73&57,74&58,74&57,75&58,75&57,76&58,76&57,77&58,77&57,78&58,78&57,79&58,79&57,80&58,80&57,81&58,81&57,82&58,82&57,83&58,83&57,84&58,84&57,85&58,85&57,86&58,86&57,87&58,87&57,88&58,88&57,89&58,89&57,90&58,90&57,91&58,91&57,92&58,92&57,93&58,93&57,94&58,94&57,95&58,95&57,96&58,96/76,0&77,0&76,1&77,1&76,2&77,2&76,3&77,3&76,4&77,4&76,5&77,5&76,6&77,6&76,7&77,7&76,8&77,8&76,9&77,9&76,10&77,10&76,11&" +
				"77,11&76,12&77,12&76,13&77,13&76,14&77,14&76,15&77,15&76,16&77,16&76,17&77,17&76,18&77,18&76,19&77,19&76,20&77,20&76,21&77,21&76,22&77,22&76,23&77,23&76,24&77,24&76,25&77,25&76,26&77,26&76,27&77,27&76,28&77,28&76,29&77,29&76,30&77,30&76,31&77,31&76,32&77,32&76,33&77,33&76,34&77,34&76,35&77,35&76,36&77,36&76,37&77,37&76,38&77,38&76,39&77,39&76,40&77,40&76,41&77,41&76,42&77,42&76,43&77,43&76,44&77,44&76,45&77,45&76,46&77,46&76,47&77,47&76,48&77,48&76,49&77,49&76,50&77,50&76,51&77,51&76,52&77,52&76" +
				",53&77,53&76,54&77,54&76,55&77,55&76,56&77,56&76,57&77,57&76,58&77,58&76,59&77,59&76,60&77,60&76,61&77,61&76,62&77,62&76,63&77,63&76,64&77,64&76,65&77,65&76,66&77,66&76,67&77,67&76,68&77,68&76,69&77,69&76,70&77,70&76,71&77,71&76,72&77,72&76,73&77,73&76,74&77,74&76,75&77,75&76,76&77,76&76,77&77,77&76,78&77,78&76,79&77,79&76,80&77,80&76,81&77,81&76,82&77,82&76,83&77,83&76,84&77,84&76,85&77,85&76,86&77,86&76,87&77,87&76,88&77,88&76,89&77,89&76,90&77,90&76,91&77,91&76,92&77,92&76,93&77,93&76,94&77,9" +
				"4&76,95&77,95&76,96&77,96/95,0&96,0&95,1&96,1&95,2&96,2&95,3&96,3&95,4&96,4&95,5&96,5&95,6&96,6&95,7&96,7&95,8&96,8&95,9&96,9&95,10&96,10&95,11&96,11&95,12&96,12&95,13&96,13&95,14&96,14&95,15&96,15&95,16&96,16&95,17&96,17&95,18&96,18&95,19&96,19&95,20&96,20&95,21&96,21&95,22&96,22&95,23&96,23&95,24&96,24&95,25&96,25&95,26&96,26&95,27&96,27&95,28&96,28&95,29&96,29&95,30&96,30&95,31&96,31&95,32&96,32&95,33&96,33&95,34&96,34&95,35&96,35&95,36&96,36&95,37&96,37&95,38&96,38&95,39&96,39&95,40&96,40&95" +
				",41&96,41&95,42&96,42&95,43&96,43&95,44&96,44&95,45&96,45&95,46&96,46&95,47&96,47&95,48&96,48&95,49&96,49&95,50&96,50&95,51&96,51&95,52&96,52&95,53&96,53&95,54&96,54&95,55&96,55&95,56&96,56&95,57&96,57&95,58&96,58&95,59&96,59&95,60&96,60&95,61&96,61&95,62&96,62&95,63&96,63&95,64&96,64&95,65&96,65&95,66&96,66&95,67&96,67&95,68&96,68&95,69&96,69&95,70&96,70&95,71&96,71&95,72&96,72&95,73&96,73&95,74&96,74&95,75&96,75&95,76&96,76&95,77&96,77&95,78&96,78&95,79&96,79&95,80&96,80&95,81&96,81&95,82&96,8" +
				"2&95,83&96,83&95,84&96,84&95,85&96,85&95,86&96,86&95,87&96,87&95,88&96,88&95,89&96,89&95,90&96,90&95,91&96,91&95,92&96,92&95,93&96,93&95,94&96,94&95,95&96,95&95,96&96,96|0,0&0,1&1,0&1,1&2,0&2,1&3,0&3,1&4,0&4,1&5,0&5,1&6,0&6,1&7,0&7,1&8,0&8,1&9,0&9,1&10,0&10,1&11,0&11,1&12,0&12,1&13,0&13,1&14,0&14,1&15,0&15,1&16,0&16,1&17,0&17,1&18,0&18,1&19,0&19,1&20,0&20,1&21,0&21,1&22,0&22,1&23,0&23,1&24,0&24,1&25,0&25,1&26,0&26,1&27,0&27,1&28,0&28,1&29,0&29,1&30,0&30,1&31,0&31,1&32,0&32,1&33,0&33,1&34,0&34,1&" +
				"35,0&35,1&36,0&36,1&37,0&37,1&38,0&38,1&39,0&39,1&40,0&40,1&41,0&41,1&42,0&42,1&43,0&43,1&44,0&44,1&45,0&45,1&46,0&46,1&47,0&47,1&48,0&48,1&49,0&49,1&50,0&50,1&51,0&51,1&52,0&52,1&53,0&53,1&54,0&54,1&55,0&55,1&56,0&56,1&57,0&57,1&58,0&58,1&59,0&59,1&60,0&60,1&61,0&61,1&62,0&62,1&63,0&63,1&64,0&64,1&65,0&65,1&66,0&66,1&67,0&67,1&68,0&68,1&69,0&69,1&70,0&70,1&71,0&71,1&72,0&72,1&73,0&73,1&74,0&74,1&75,0&75,1&76,0&76,1&77,0&77,1&78,0&78,1&79,0&79,1&80,0&80,1&81,0&81,1&82,0&82,1&83,0&83,1&84,0&84,1&" +
				"85,0&85,1&86,0&86,1&87,0&87,1&88,0&88,1&89,0&89,1&90,0&90,1&91,0&91,1&92,0&92,1&93,0&93,1&94,0&94,1&95,0&95,1&96,0&96,1/0,19&0,20&1,19&1,20&2,19&2,20&3,19&3,20&4,19&4,20&5,19&5,20&6,19&6,20&7,19&7,20&8,19&8,20&9,19&9,20&10,19&10,20&11,19&11,20&12,19&12,20&13,19&13,20&14,19&14,20&15,19&15,20&16,19&16,20&17,19&17,20&18,19&18,20&19,19&19,20&20,19&20,20&21,19&21,20&22,19&22,20&23,19&23,20&24,19&24,20&25,19&25,20&26,19&26,20&27,19&27,20&28,19&28,20&29,19&29,20&30,19&30,20&31,19&31,20&32,19&32,20&33,1" +
				"9&33,20&34,19&34,20&35,19&35,20&36,19&36,20&37,19&37,20&38,19&38,20&39,19&39,20&40,19&40,20&41,19&41,20&42,19&42,20&43,19&43,20&44,19&44,20&45,19&45,20&46,19&46,20&47,19&47,20&48,19&48,20&49,19&49,20&50,19&50,20&51,19&51,20&52,19&52,20&53,19&53,20&54,19&54,20&55,19&55,20&56,19&56,20&57,19&57,20&58,19&58,20&59,19&59,20&60,19&60,20&61,19&61,20&62,19&62,20&63,19&63,20&64,19&64,20&65,19&65,20&66,19&66,20&67,19&67,20&68,19&68,20&69,19&69,20&70,19&70,20&71,19&71,20&72,19&72,20&73,19&73,20&74,19&74,20&" +
				"75,19&75,20&76,19&76,20&77,19&77,20&78,19&78,20&79,19&79,20&80,19&80,20&81,19&81,20&82,19&82,20&83,19&83,20&84,19&84,20&85,19&85,20&86,19&86,20&87,19&87,20&88,19&88,20&89,19&89,20&90,19&90,20&91,19&91,20&92,19&92,20&93,19&93,20&94,19&94,20&95,19&95,20&96,19&96,20/0,38&0,39&1,38&1,39&2,38&2,39&3,38&3,39&4,38&4,39&5,38&5,39&6,38&6,39&7,38&7,39&8,38&8,39&9,38&9,39&10,38&10,39&11,38&11,39&12,38&12,39&13,38&13,39&14,38&14,39&15,38&15,39&16,38&16,39&17,38&17,39&18,38&18,39&19,38&19,39&20,38&20,39&21,3" +
				"8&21,39&22,38&22,39&23,38&23,39&24,38&24,39&25,38&25,39&26,38&26,39&27,38&27,39&28,38&28,39&29,38&29,39&30,38&30,39&31,38&31,39&32,38&32,39&33,38&33,39&34,38&34,39&35,38&35,39&36,38&36,39&37,38&37,39&38,38&38,39&39,38&39,39&40,38&40,39&41,38&41,39&42,38&42,39&43,38&43,39&44,38&44,39&45,38&45,39&46,38&46,39&47,38&47,39&48,38&48,39&49,38&49,39&50,38&50,39&51,38&51,39&52,38&52,39&53,38&53,39&54,38&54,39&55,38&55,39&56,38&56,39&57,38&57,39&58,38&58,39&59,38&59,39&60,38&60,39&61,38&61,39&62,38&62,39&" +
				"63,38&63,39&64,38&64,39&65,38&65,39&66,38&66,39&67,38&67,39&68,38&68,39&69,38&69,39&70,38&70,39&71,38&71,39&72,38&72,39&73,38&73,39&74,38&74,39&75,38&75,39&76,38&76,39&77,38&77,39&78,38&78,39&79,38&79,39&80,38&80,39&81,38&81,39&82,38&82,39&83,38&83,39&84,38&84,39&85,38&85,39&86,38&86,39&87,38&87,39&88,38&88,39&89,38&89,39&90,38&90,39&91,38&91,39&92,38&92,39&93,38&93,39&94,38&94,39&95,38&95,39&96,38&96,39/0,57&0,58&1,57&1,58&2,57&2,58&3,57&3,58&4,57&4,58&5,57&5,58&6,57&6,58&7,57&7,58&8,57&8,58&9," +
				"57&9,58&10,57&10,58&11,57&11,58&12,57&12,58&13,57&13,58&14,57&14,58&15,57&15,58&16,57&16,58&17,57&17,58&18,57&18,58&19,57&19,58&20,57&20,58&21,57&21,58&22,57&22,58&23,57&23,58&24,57&24,58&25,57&25,58&26,57&26,58&27,57&27,58&28,57&28,58&29,57&29,58&30,57&30,58&31,57&31,58&32,57&32,58&33,57&33,58&34,57&34,58&35,57&35,58&36,57&36,58&37,57&37,58&38,57&38,58&39,57&39,58&40,57&40,58&41,57&41,58&42,57&42,58&43,57&43,58&44,57&44,58&45,57&45,58&46,57&46,58&47,57&47,58&48,57&48,58&49,57&49,58&50,57&50,58&" +
				"51,57&51,58&52,57&52,58&53,57&53,58&54,57&54,58&55,57&55,58&56,57&56,58&57,57&57,58&58,57&58,58&59,57&59,58&60,57&60,58&61,57&61,58&62,57&62,58&63,57&63,58&64,57&64,58&65,57&65,58&66,57&66,58&67,57&67,58&68,57&68,58&69,57&69,58&70,57&70,58&71,57&71,58&72,57&72,58&73,57&73,58&74,57&74,58&75,57&75,58&76,57&76,58&77,57&77,58&78,57&78,58&79,57&79,58&80,57&80,58&81,57&81,58&82,57&82,58&83,57&83,58&84,57&84,58&85,57&85,58&86,57&86,58&87,57&87,58&88,57&88,58&89,57&89,58&90,57&90,58&91,57&91,58&92,57&92" +
				",58&93,57&93,58&94,57&94,58&95,57&95,58&96,57&96,58/0,76&0,77&1,76&1,77&2,76&2,77&3,76&3,77&4,76&4,77&5,76&5,77&6,76&6,77&7,76&7,77&8,76&8,77&9,76&9,77&10,76&10,77&11,76&11,77&12,76&12,77&13,76&13,77&14,76&14,77&15,76&15,77&16,76&16,77&17,76&17,77&18,76&18,77&19,76&19,77&20,76&20,77&21,76&21,77&22,76&22,77&23,76&23,77&24,76&24,77&25,76&25,77&26,76&26,77&27,76&27,77&28,76&28,77&29,76&29,77&30,76&30,77&31,76&31,77&32,76&32,77&33,76&33,77&34,76&34,77&35,76&35,77&36,76&36,77&37,76&37,77&38,76&38,77&" +
				"39,76&39,77&40,76&40,77&41,76&41,77&42,76&42,77&43,76&43,77&44,76&44,77&45,76&45,77&46,76&46,77&47,76&47,77&48,76&48,77&49,76&49,77&50,76&50,77&51,76&51,77&52,76&52,77&53,76&53,77&54,76&54,77&55,76&55,77&56,76&56,77&57,76&57,77&58,76&58,77&59,76&59,77&60,76&60,77&61,76&61,77&62,76&62,77&63,76&63,77&64,76&64,77&65,76&65,77&66,76&66,77&67,76&67,77&68,76&68,77&69,76&69,77&70,76&70,77&71,76&71,77&72,76&72,77&73,76&73,77&74,76&74,77&75,76&75,77&76,76&76,77&77,76&77,77&78,76&78,77&79,76&79,77&80,76&80" +
				",77&81,76&81,77&82,76&82,77&83,76&83,77&84,76&84,77&85,76&85,77&86,76&86,77&87,76&87,77&88,76&88,77&89,76&89,77&90,76&90,77&91,76&91,77&92,76&92,77&93,76&93,77&94,76&94,77&95,76&95,77&96,76&96,77/0,95&0,96&1,95&1,96&2,95&2,96&3,95&3,96&4,95&4,96&5,95&5,96&6,95&6,96&7,95&7,96&8,95&8,96&9,95&9,96&10,95&10,96&11,95&11,96&12,95&12,96&13,95&13,96&14,95&14,96&15,95&15,96&16,95&16,96&17,95&17,96&18,95&18,96&19,95&19,96&20,95&20,96&21,95&21,96&22,95&22,96&23,95&23,96&24,95&24,96&25,95&25,96&26,95&26,96&" +
				"27,95&27,96&28,95&28,96&29,95&29,96&30,95&30,96&31,95&31,96&32,95&32,96&33,95&33,96&34,95&34,96&35,95&35,96&36,95&36,96&37,95&37,96&38,95&38,96&39,95&39,96&40,95&40,96&41,95&41,96&42,95&42,96&43,95&43,96&44,95&44,96&45,95&45,96&46,95&46,96&47,95&47,96&48,95&48,96&49,95&49,96&50,95&50,96&51,95&51,96&52,95&52,96&53,95&53,96&54,95&54,96&55,95&55,96&56,95&56,96&57,95&57,96&58,95&58,96&59,95&59,96&60,95&60,96&61,95&61,96&62,95&62,96&63,95&63,96&64,95&64,96&65,95&65,96&66,95&66,96&67,95&67,96&68,95&68" +
				",96&69,95&69,96&70,95&70,96&71,95&71,96&72,95&72,96&73,95&73,96&74,95&74,96&75,95&75,96&76,95&76,96&77,95&77,96&78,95&78,96&79,95&79,96&80,95&80,96&81,95&81,96&82,95&82,96&83,95&83,96&84,95&84,96&85,95&85,96&86,95&86,96&87,95&87,96&88,95&88,96&89,95&89,96&90,95&90,96&91,95&91,96&92,95&92,96&93,95&93,96&94,95&94,96&95,95&95,96&96,95&96,96|0,0&1,0&0,1&1,1&0,2&1,2&0,3&1,3&0,4&1,4&0,5&1,5&0,6&1,6&0,7&1,7&0,8&1,8&0,9&1,9&0,10&1,10&0,11&1,11&0,12&1,12&0,13&1,13&0,14&1,14&0,15&1,15&0,16&1,16&0,17&1,17&" +
				"0,18&1,18&0,19&1,19&0,20&1,20&0,21&1,21&0,22&1,22&0,23&1,23&0,24&1,24&0,25&1,25&0,26&1,26&0,27&1,27&0,28&1,28&0,29&1,29&0,30&1,30&0,31&1,31&0,32&1,32&0,33&1,33&0,34&1,34&0,35&1,35&0,36&1,36&0,37&1,37&0,38&1,38&0,39&1,39&0,40&1,40&0,41&1,41&0,42&1,42&0,43&1,43&0,44&1,44&0,45&1,45&0,46&1,46&0,47&1,47&0,48&1,48&0,49&1,49&0,50&1,50&0,51&1,51&0,52&1,52&0,53&1,53&0,54&1,54&0,55&1,55&0,56&1,56&0,57&1,57&0,58&1,58&0,59&1,59&0,60&1,60&0,61&1,61&0,62&1,62&0,63&1,63&0,64&1,64&0,65&1,65&0,66&1,66&0,67&1,67&" +
				"0,68&1,68&0,69&1,69&0,70&1,70&0,71&1,71&0,72&1,72&0,73&1,73&0,74&1,74&0,75&1,75&0,76&1,76&0,77&1,77&0,78&1,78&0,79&1,79&0,80&1,80&0,81&1,81&0,82&1,82&0,83&1,83&0,84&1,84&0,85&1,85&0,86&1,86&0,87&1,87&0,88&1,88&0,89&1,89&0,90&1,90&0,91&1,91&0,92&1,92&0,93&1,93&0,94&1,94&0,95&1,95&0,96&1,96/19,0&20,0&19,1&20,1&19,2&20,2&19,3&20,3&19,4&20,4&19,5&20,5&19,6&20,6&19,7&20,7&19,8&20,8&19,9&20,9&19,10&20,10&19,11&20,11&19,12&20,12&19,13&20,13&19,14&20,14&19,15&20,15&19,16&20,16&19,17&20,17&19,18&20,18&19" +
				",19&20,19&19,20&20,20&19,21&20,21&19,22&20,22&19,23&20,23&19,24&20,24&19,25&20,25&19,26&20,26&19,27&20,27&19,28&20,28&19,29&20,29&19,30&20,30&19,31&20,31&19,32&20,32&19,33&20,33&19,34&20,34&19,35&20,35&19,36&20,36&19,37&20,37&19,38&20,38&19,39&20,39&19,40&20,40&19,41&20,41&19,42&20,42&19,43&20,43&19,44&20,44&19,45&20,45&19,46&20,46&19,47&20,47&19,48&20,48&19,49&20,49&19,50&20,50&19,51&20,51&19,52&20,52&19,53&20,53&19,54&20,54&19,55&20,55&19,56&20,56&19,57&20,57&19,58&20,58&19,59&20,59&19,60&20,6" +
				"0&19,61&20,61&19,62&20,62&19,63&20,63&19,64&20,64&19,65&20,65&19,66&20,66&19,67&20,67&19,68&20,68&19,69&20,69&19,70&20,70&19,71&20,71&19,72&20,72&19,73&20,73&19,74&20,74&19,75&20,75&19,76&20,76&19,77&20,77&19,78&20,78&19,79&20,79&19,80&20,80&19,81&20,81&19,82&20,82&19,83&20,83&19,84&20,84&19,85&20,85&19,86&20,86&19,87&20,87&19,88&20,88&19,89&20,89&19,90&20,90&19,91&20,91&19,92&20,92&19,93&20,93&19,94&20,94&19,95&20,95&19,96&20,96/38,0&39,0&38,1&39,1&38,2&39,2&38,3&39,3&38,4&39,4&38,5&39,5&38,6&3" +
				"9,6&38,7&39,7&38,8&39,8&38,9&39,9&38,10&39,10&38,11&39,11&38,12&39,12&38,13&39,13&38,14&39,14&38,15&39,15&38,16&39,16&38,17&39,17&38,18&39,18&38,19&39,19&38,20&39,20&38,21&39,21&38,22&39,22&38,23&39,23&38,24&39,24&38,25&39,25&38,26&39,26&38,27&39,27&38,28&39,28&38,29&39,29&38,30&39,30&38,31&39,31&38,32&39,32&38,33&39,33&38,34&39,34&38,35&39,35&38,36&39,36&38,37&39,37&38,38&39,38&38,39&39,39&38,40&39,40&38,41&39,41&38,42&39,42&38,43&39,43&38,44&39,44&38,45&39,45&38,46&39,46&38,47&39,47&38,48&39,4" +
				"8&38,49&39,49&38,50&39,50&38,51&39,51&38,52&39,52&38,53&39,53&38,54&39,54&38,55&39,55&38,56&39,56&38,57&39,57&38,58&39,58&38,59&39,59&38,60&39,60&38,61&39,61&38,62&39,62&38,63&39,63&38,64&39,64&38,65&39,65&38,66&39,66&38,67&39,67&38,68&39,68&38,69&39,69&38,70&39,70&38,71&39,71&38,72&39,72&38,73&39,73&38,74&39,74&38,75&39,75&38,76&39,76&38,77&39,77&38,78&39,78&38,79&39,79&38,80&39,80&38,81&39,81&38,82&39,82&38,83&39,83&38,84&39,84&38,85&39,85&38,86&39,86&38,87&39,87&38,88&39,88&38,89&39,89&38,90&" +
				"39,90&38,91&39,91&38,92&39,92&38,93&39,93&38,94&39,94&38,95&39,95&38,96&39,96/57,0&58,0&57,1&58,1&57,2&58,2&57,3&58,3&57,4&58,4&57,5&58,5&57,6&58,6&57,7&58,7&57,8&58,8&57,9&58,9&57,10&58,10&57,11&58,11&57,12&58,12&57,13&58,13&57,14&58,14&57,15&58,15&57,16&58,16&57,17&58,17&57,18&58,18&57,19&58,19&57,20&58,20&57,21&58,21&57,22&58,22&57,23&58,23&57,24&58,24&57,25&58,25&57,26&58,26&57,27&58,27&57,28&58,28&57,29&58,29&57,30&58,30&57,31&58,31&57,32&58,32&57,33&58,33&57,34&58,34&57,35&58,35&57,36&58,3" +
				"6&57,37&58,37&57,38&58,38&57,39&58,39&57,40&58,40&57,41&58,41&57,42&58,42&57,43&58,43&57,44&58,44&57,45&58,45&57,46&58,46&57,47&58,47&57,48&58,48&57,49&58,49&57,50&58,50&57,51&58,51&57,52&58,52&57,53&58,53&57,54&58,54&57,55&58,55&57,56&58,56&57,57&58,57&57,58&58,58&57,59&58,59&57,60&58,60&57,61&58,61&57,62&58,62&57,63&58,63&57,64&58,64&57,65&58,65&57,66&58,66&57,67&58,67&57,68&58,68&57,69&58,69&57,70&58,70&57,71&58,71&57,72&58,72&57,73&58,73&57,74&58,74&57,75&58,75&57,76&58,76&57,77&58,77&57,78&" +
				"58,78&57,79&58,79&57,80&58,80&57,81&58,81&57,82&58,82&57,83&58,83&57,84&58,84&57,85&58,85&57,86&58,86&57,87&58,87&57,88&58,88&57,89&58,89&57,90&58,90&57,91&58,91&57,92&58,92&57,93&58,93&57,94&58,94&57,95&58,95&57,96&58,96/76,0&77,0&76,1&77,1&76,2&77,2&76,3&77,3&76,4&77,4&76,5&77,5&76,6&77,6&76,7&77,7&76,8&77,8&76,9&77,9&76,10&77,10&76,11&77,11&76,12&77,12&76,13&77,13&76,14&77,14&76,15&77,15&76,16&77,16&76,17&77,17&76,18&77,18&76,19&77,19&76,20&77,20&76,21&77,21&76,22&77,22&76,23&77,23&76,24&77,2" +
				"4&76,25&77,25&76,26&77,26&76,27&77,27&76,28&77,28&76,29&77,29&76,30&77,30&76,31&77,31&76,32&77,32&76,33&77,33&76,34&77,34&76,35&77,35&76,36&77,36&76,37&77,37&76,38&77,38&76,39&77,39&76,40&77,40&76,41&77,41&76,42&77,42&76,43&77,43&76,44&77,44&76,45&77,45&76,46&77,46&76,47&77,47&76,48&77,48&76,49&77,49&76,50&77,50&76,51&77,51&76,52&77,52&76,53&77,53&76,54&77,54&76,55&77,55&76,56&77,56&76,57&77,57&76,58&77,58&76,59&77,59&76,60&77,60&76,61&77,61&76,62&77,62&76,63&77,63&76,64&77,64&76,65&77,65&76,66&" +
				"77,66&76,67&77,67&76,68&77,68&76,69&77,69&76,70&77,70&76,71&77,71&76,72&77,72&76,73&77,73&76,74&77,74&76,75&77,75&76,76&77,76&76,77&77,77&76,78&77,78&76,79&77,79&76,80&77,80&76,81&77,81&76,82&77,82&76,83&77,83&76,84&77,84&76,85&77,85&76,86&77,86&76,87&77,87&76,88&77,88&76,89&77,89&76,90&77,90&76,91&77,91&76,92&77,92&76,93&77,93&76,94&77,94&76,95&77,95&76,96&77,96/95,0&96,0&95,1&96,1&95,2&96,2&95,3&96,3&95,4&96,4&95,5&96,5&95,6&96,6&95,7&96,7&95,8&96,8&95,9&96,9&95,10&96,10&95,11&96,11&95,12&96,1" +
				"2&95,13&96,13&95,14&96,14&95,15&96,15&95,16&96,16&95,17&96,17&95,18&96,18&95,19&96,19&95,20&96,20&95,21&96,21&95,22&96,22&95,23&96,23&95,24&96,24&95,25&96,25&95,26&96,26&95,27&96,27&95,28&96,28&95,29&96,29&95,30&96,30&95,31&96,31&95,32&96,32&95,33&96,33&95,34&96,34&95,35&96,35&95,36&96,36&95,37&96,37&95,38&96,38&95,39&96,39&95,40&96,40&95,41&96,41&95,42&96,42&95,43&96,43&95,44&96,44&95,45&96,45&95,46&96,46&95,47&96,47&95,48&96,48&95,49&96,49&95,50&96,50&95,51&96,51&95,52&96,52&95,53&96,53&95,54&" +
				"96,54&95,55&96,55&95,56&96,56&95,57&96,57&95,58&96,58&95,59&96,59&95,60&96,60&95,61&96,61&95,62&96,62&95,63&96,63&95,64&96,64&95,65&96,65&95,66&96,66&95,67&96,67&95,68&96,68&95,69&96,69&95,70&96,70&95,71&96,71&95,72&96,72&95,73&96,73&95,74&96,74&95,75&96,75&95,76&96,76&95,77&96,77&95,78&96,78&95,79&96,79&95,80&96,80&95,81&96,81&95,82&96,82&95,83&96,83&95,84&96,84&95,85&96,85&95,86&96,86&95,87&96,87&95,88&96,88&95,89&96,89&95,90&96,90&95,91&96,91&95,92&96,92&95,93&96,93&95,94&96,94&95,95&96,95&95" +
				",96&96,96/0,0&0,1&1,0&1,1&2,0&2,1&3,0&3,1&4,0&4,1&5,0&5,1&6,0&6,1&7,0&7,1&8,0&8,1&9,0&9,1&10,0&10,1&11,0&11,1&12,0&12,1&13,0&13,1&14,0&14,1&15,0&15,1&16,0&16,1&17,0&17,1&18,0&18,1&19,0&19,1&20,0&20,1&21,0&21,1&22,0&22,1&23,0&23,1&24,0&24,1&25,0&25,1&26,0&26,1&27,0&27,1&28,0&28,1&29,0&29,1&30,0&30,1&31,0&31,1&32,0&32,1&33,0&33,1&34,0&34,1&35,0&35,1&36,0&36,1&37,0&37,1&38,0&38,1&39,0&39,1&40,0&40,1&41,0&41,1&42,0&42,1&43,0&43,1&44,0&44,1&45,0&45,1&46,0&46,1&47,0&47,1&48,0&48,1&49,0&49,1&50,0&50,1&" +
				"51,0&51,1&52,0&52,1&53,0&53,1&54,0&54,1&55,0&55,1&56,0&56,1&57,0&57,1&58,0&58,1&59,0&59,1&60,0&60,1&61,0&61,1&62,0&62,1&63,0&63,1&64,0&64,1&65,0&65,1&66,0&66,1&67,0&67,1&68,0&68,1&69,0&69,1&70,0&70,1&71,0&71,1&72,0&72,1&73,0&73,1&74,0&74,1&75,0&75,1&76,0&76,1&77,0&77,1&78,0&78,1&79,0&79,1&80,0&80,1&81,0&81,1&82,0&82,1&83,0&83,1&84,0&84,1&85,0&85,1&86,0&86,1&87,0&87,1&88,0&88,1&89,0&89,1&90,0&90,1&91,0&91,1&92,0&92,1&93,0&93,1&94,0&94,1&95,0&95,1&96,0&96,1/0,19&0,20&1,19&1,20&2,19&2,20&3,19&3,20&" +
				"4,19&4,20&5,19&5,20&6,19&6,20&7,19&7,20&8,19&8,20&9,19&9,20&10,19&10,20&11,19&11,20&12,19&12,20&13,19&13,20&14,19&14,20&15,19&15,20&16,19&16,20&17,19&17,20&18,19&18,20&19,19&19,20&20,19&20,20&21,19&21,20&22,19&22,20&23,19&23,20&24,19&24,20&25,19&25,20&26,19&26,20&27,19&27,20&28,19&28,20&29,19&29,20&30,19&30,20&31,19&31,20&32,19&32,20&33,19&33,20&34,19&34,20&35,19&35,20&36,19&36,20&37,19&37,20&38,19&38,20&39,19&39,20&40,19&40,20&41,19&41,20&42,19&42,20&43,19&43,20&44,19&44,20&45,19&45,20&46,19&46" +
				",20&47,19&47,20&48,19&48,20&49,19&49,20&50,19&50,20&51,19&51,20&52,19&52,20&53,19&53,20&54,19&54,20&55,19&55,20&56,19&56,20&57,19&57,20&58,19&58,20&59,19&59,20&60,19&60,20&61,19&61,20&62,19&62,20&63,19&63,20&64,19&64,20&65,19&65,20&66,19&66,20&67,19&67,20&68,19&68,20&69,19&69,20&70,19&70,20&71,19&71,20&72,19&72,20&73,19&73,20&74,19&74,20&75,19&75,20&76,19&76,20&77,19&77,20&78,19&78,20&79,19&79,20&80,19&80,20&81,19&81,20&82,19&82,20&83,19&83,20&84,19&84,20&85,19&85,20&86,19&86,20&87,19&87,20&88,1" +
				"9&88,20&89,19&89,20&90,19&90,20&91,19&91,20&92,19&92,20&93,19&93,20&94,19&94,20&95,19&95,20&96,19&96,20/0,38&0,39&1,38&1,39&2,38&2,39&3,38&3,39&4,38&4,39&5,38&5,39&6,38&6,39&7,38&7,39&8,38&8,39&9,38&9,39&10,38&10,39&11,38&11,39&12,38&12,39&13,38&13,39&14,38&14,39&15,38&15,39&16,38&16,39&17,38&17,39&18,38&18,39&19,38&19,39&20,38&20,39&21,38&21,39&22,38&22,39&23,38&23,39&24,38&24,39&25,38&25,39&26,38&26,39&27,38&27,39&28,38&28,39&29,38&29,39&30,38&30,39&31,38&31,39&32,38&32,39&33,38&33,39&34,38&34" +
				",39&35,38&35,39&36,38&36,39&37,38&37,39&38,38&38,39&39,38&39,39&40,38&40,39&41,38&41,39&42,38&42,39&43,38&43,39&44,38&44,39&45,38&45,39&46,38&46,39&47,38&47,39&48,38&48,39&49,38&49,39&50,38&50,39&51,38&51,39&52,38&52,39&53,38&53,39&54,38&54,39&55,38&55,39&56,38&56,39&57,38&57,39&58,38&58,39&59,38&59,39&60,38&60,39&61,38&61,39&62,38&62,39&63,38&63,39&64,38&64,39&65,38&65,39&66,38&66,39&67,38&67,39&68,38&68,39&69,38&69,39&70,38&70,39&71,38&71,39&72,38&72,39&73,38&73,39&74,38&74,39&75,38&75,39&76,3" +
				"8&76,39&77,38&77,39&78,38&78,39&79,38&79,39&80,38&80,39&81,38&81,39&82,38&82,39&83,38&83,39&84,38&84,39&85,38&85,39&86,38&86,39&87,38&87,39&88,38&88,39&89,38&89,39&90,38&90,39&91,38&91,39&92,38&92,39&93,38&93,39&94,38&94,39&95,38&95,39&96,38&96,39/0,57&0,58&1,57&1,58&2,57&2,58&3,57&3,58&4,57&4,58&5,57&5,58&6,57&6,58&7,57&7,58&8,57&8,58&9,57&9,58&10,57&10,58&11,57&11,58&12,57&12,58&13,57&13,58&14,57&14,58&15,57&15,58&16,57&16,58&17,57&17,58&18,57&18,58&19,57&19,58&20,57&20,58&21,57&21,58&22,57&22" +
				",58&23,57&23,58&24,57&24,58&25,57&25,58&26,57&26,58&27,57&27,58&28,57&28,58&29,57&29,58&30,57&30,58&31,57&31,58&32,57&32,58&33,57&33,58&34,57&34,58&35,57&35,58&36,57&36,58&37,57&37,58&38,57&38,58&39,57&39,58&40,57&40,58&41,57&41,58&42,57&42,58&43,57&43,58&44,57&44,58&45,57&45,58&46,57&46,58&47,57&47,58&48,57&48,58&49,57&49,58&50,57&50,58&51,57&51,58&52,57&52,58&53,57&53,58&54,57&54,58&55,57&55,58&56,57&56,58&57,57&57,58&58,57&58,58&59,57&59,58&60,57&60,58&61,57&61,58&62,57&62,58&63,57&63,58&64,5" +
				"7&64,58&65,57&65,58&66,57&66,58&67,57&67,58&68,57&68,58&69,57&69,58&70,57&70,58&71,57&71,58&72,57&72,58&73,57&73,58&74,57&74,58&75,57&75,58&76,57&76,58&77,57&77,58&78,57&78,58&79,57&79,58&80,57&80,58&81,57&81,58&82,57&82,58&83,57&83,58&84,57&84,58&85,57&85,58&86,57&86,58&87,57&87,58&88,57&88,58&89,57&89,58&90,57&90,58&91,57&91,58&92,57&92,58&93,57&93,58&94,57&94,58&95,57&95,58&96,57&96,58/0,76&0,77&1,76&1,77&2,76&2,77&3,76&3,77&4,76&4,77&5,76&5,77&6,76&6,77&7,76&7,77&8,76&8,77&9,76&9,77&10,76&10" +
				",77&11,76&11,77&12,76&12,77&13,76&13,77&14,76&14,77&15,76&15,77&16,76&16,77&17,76&17,77&18,76&18,77&19,76&19,77&20,76&20,77&21,76&21,77&22,76&22,77&23,76&23,77&24,76&24,77&25,76&25,77&26,76&26,77&27,76&27,77&28,76&28,77&29,76&29,77&30,76&30,77&31,76&31,77&32,76&32,77&33,76&33,77&34,76&34,77&35,76&35,77&36,76&36,77&37,76&37,77&38,76&38,77&39,76&39,77&40,76&40,77&41,76&41,77&42,76&42,77&43,76&43,77&44,76&44,77&45,76&45,77&46,76&46,77&47,76&47,77&48,76&48,77&49,76&49,77&50,76&50,77&51,76&51,77&52,7" +
				"6&52,77&53,76&53,77&54,76&54,77&55,76&55,77&56,76&56,77&57,76&57,77&58,76&58,77&59,76&59,77&60,76&60,77&61,76&61,77&62,76&62,77&63,76&63,77&64,76&64,77&65,76&65,77&66,76&66,77&67,76&67,77&68,76&68,77&69,76&69,77&70,76&70,77&71,76&71,77&72,76&72,77&73,76&73,77&74,76&74,77&75,76&75,77&76,76&76,77&77,76&77,77&78,76&78,77&79,76&79,77&80,76&80,77&81,76&81,77&82,76&82,77&83,76&83,77&84,76&84,77&85,76&85,77&86,76&86,77&87,76&87,77&88,76&88,77&89,76&89,77&90,76&90,77&91,76&91,77&92,76&92,77&93,76&93,77&" +
				"94,76&94,77&95,76&95,77&96,76&96,77/0,95&0,96&1,95&1,96&2,95&2,96&3,95&3,96&4,95&4,96&5,95&5,96&6,95&6,96&7,95&7,96&8,95&8,96&9,95&9,96&10,95&10,96&11,95&11,96&12,95&12,96&13,95&13,96&14,95&14,96&15,95&15,96&16,95&16,96&17,95&17,96&18,95&18,96&19,95&19,96&20,95&20,96&21,95&21,96&22,95&22,96&23,95&23,96&24,95&24,96&25,95&25,96&26,95&26,96&27,95&27,96&28,95&28,96&29,95&29,96&30,95&30,96&31,95&31,96&32,95&32,96&33,95&33,96&34,95&34,96&35,95&35,96&36,95&36,96&37,95&37,96&38,95&38,96&39,95&39,96&40,9" +
				"5&40,96&41,95&41,96&42,95&42,96&43,95&43,96&44,95&44,96&45,95&45,96&46,95&46,96&47,95&47,96&48,95&48,96&49,95&49,96&50,95&50,96&51,95&51,96&52,95&52,96&53,95&53,96&54,95&54,96&55,95&55,96&56,95&56,96&57,95&57,96&58,95&58,96&59,95&59,96&60,95&60,96&61,95&61,96&62,95&62,96&63,95&63,96&64,95&64,96&65,95&65,96&66,95&66,96&67,95&67,96&68,95&68,96&69,95&69,96&70,95&70,96&71,95&71,96&72,95&72,96&73,95&73,96&74,95&74,96&75,95&75,96&76,95&76,96&77,95&77,96&78,95&78,96&79,95&79,96&80,95&80,96&81,95&81,96&" +
				"82,95&82,96&83,95&83,96&84,95&84,96&85,95&85,96&86,95&86,96&87,95&87,96&88,95&88,96&89,95&89,96&90,95&90,96&91,95&91,96&92,95&92,96&93,95&93,96&94,95&94,96&95,95&95,96&96,95&96,96";
			var useZones = new List<int> { 0, 0, 1, 1, 0, 0, 1, 1, 0, 1, 0, 1, 0, 1, 1, 2, 2, 2, 2, 2 };
			var zones = ZonesStr.Split('|').Select(str1 => str1.Split('/').Select(str => str.Split('&').Select(Point.Parse).ToList()).ToList()).ToList();
			var rand = new Random(0xbadbeef);
			var segment = new Segment();
			var lightColor = new LightColor(0, 6, new List<int> { 0x101010 }, new List<int> { 0x100808, 0x100000 }, new List<int> { 0x100010, 0x001010 }, new List<int> { 0x001000, 0x081008, 0x081000, 0x001008 }, new List<int> { 0x000010, 0x100010, 0x101010 }, new List<int> { 0x101010, 0x100808, 0x100000, 0x100010, 0x001010, 0x001000, 0x081008, 0x081000, 0x001008, 0x000010 });
			List<PointLinesLight> pointLinesLights = null;
			time = 0;
			for (var useZoneCtr = 0; useZoneCtr < useZones.Count; ++useZoneCtr)
			{
				var prevUseZone = useZones[useZoneCtr];
				var useZone = useZoneCtr + 1 >= useZones.Count ? useZones[useZoneCtr] : useZones[useZoneCtr + 1];
				if (pointLinesLights == null)
					pointLinesLights = zones[useZone].SelectMany(x => x.OrderBy(y => rand.Next()).Take(PointCount).Select(y => new PointLinesLight(y, rand.Next(7)))).ToList();

				if (prevUseZone == useZone)
					pointLinesLights.ForEach((pll, index) => pll.Dest = zones[useZone].Where(x => x.Contains(pll.Current)).Select(x => x[rand.Next(x.Count)]).OrderBy(x => rand.Next()).First());
				else
					pointLinesLights.ForEach((pll, index) => pll.Dest = zones[useZone][index % zones[useZone].Count].OrderBy(x => rand.Next()).First());
				prevUseZone = useZone;

				for (var timeCtr = 0; timeCtr < LoopTime; ++timeCtr)
				{
					segment.Clear(time);

					for (var pointLinesLightCtr = 0; pointLinesLightCtr < pointLinesLights.Count; ++pointLinesLightCtr)
					{
						var pointLinesLight = pointLinesLights[pointLinesLightCtr];
						foreach (var light in bodyLayout.GetPositionLights(pointLinesLight.Location, 1, 1))
							segment.AddLight(light, time, lightColor, pointLinesLight.Color);

						if (timeCtr >= MoveTime)
							pointLinesLight.Percent += PercentIncrease;
					}
					++time;
				}
			}

			return segment;
		}

		Segment MoveMelody()
		{
			const int BeatMoveBefore = 10;
			const int BeatMoveTime = 20;
			const int Size = 40;
			const int SegmentEndTime = 12800;
			const int FadeTime = 50;

			var beats = new List<Tuple<MidiNote, double>>
			{
				Tuple.Create(new MidiNote(MidiNote.PianoNote.G, 4, 100), 0d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.G, 4, 200), 9.5d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.G, 4, 300), 19d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.G, 4, 350), 28.5d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.F, 4, 500), 38d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.E, 4, 600), 47.5d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.D, 4, 700), 57d),

				Tuple.Create(new MidiNote(MidiNote.PianoNote.E, 4, 900), 0d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.E, 4, 1000), 9.5d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.E, 4, 1050), 19d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.E, 4, 1150), 28.5d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.D, 4, 1300), 38d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.C, 4, 1400), 47.5d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.B, 3, 1500), 57d),

				Tuple.Create(new MidiNote(MidiNote.PianoNote.A, 3, 1700), 0d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.C, 4, 1800), 9.5d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.F, 4, 1900), 19d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.E, 4, 2000), 28.5d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.D, 4, 2100), 38d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.C, 4, 2200), 47.5d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.A, 3, 2300), 57d),

				Tuple.Create(new MidiNote(MidiNote.PianoNote.C, 4, 2400), 0d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.C, 4, 2600), 28.5d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.G, 3, 2800), 57d),

				Tuple.Create(new MidiNote(MidiNote.PianoNote.G, 4, 3300), 0d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.G, 4, 3400), 9.5d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.G, 4, 3550), 19d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.G, 4, 3600), 28.5d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.F, 4, 3650), 38d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.E, 4, 3750), 47.5d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.D, 4, 3900), 57d),

				Tuple.Create(new MidiNote(MidiNote.PianoNote.E, 4, 4150), 0d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.E, 4, 4200), 9.5d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.E, 4, 4350), 19d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.E, 4, 4400), 28.5d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.D, 4, 4500), 38d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.C, 4, 4550), 47.5d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.B, 3, 4700), 57d),

				Tuple.Create(new MidiNote(MidiNote.PianoNote.A, 3, 4900), 0d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.C, 4, 5000), 9.5d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.F, 4, 5100), 19d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.E, 4, 5200), 28.5d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.D, 4, 5300), 38d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.C, 4, 5400), 47.5d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.A, 3, 5500), 57d),

				Tuple.Create(new MidiNote(MidiNote.PianoNote.C, 4, 5600), 0d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.C, 4, 5800), 28.5d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.G, 3, 6000), 57d),

				Tuple.Create(new MidiNote(MidiNote.PianoNote.G, 4, 6500), 0d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.G, 4, 6600), 5.7d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.G, 4, 6700), 11.4d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.G, 4, 6750), 17.1d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.E, 4, 7000), 22.8d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.F, 4, 7050), 28.5d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.G, 4, 7150), 34.2d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.F, 4, 7300), 39.9d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.E, 4, 7400), 45.6d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.D, 4, 7450), 51.3d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.DFlat, 4, 7550), 57d),

				Tuple.Create(new MidiNote(MidiNote.PianoNote.F, 4, 8100), 0d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.F, 4, 8200), 5.7d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.F, 4, 8300), 11.4d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.F, 4, 8350), 17.1d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.D, 4, 8600), 22.8d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.E, 4, 8700), 28.5d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.F, 4, 8750), 34.2d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.G, 4, 8900), 39.9d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.F, 4, 8950), 45.6d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.E, 4, 9100), 51.3d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.D, 4, 9150), 57d),

				Tuple.Create(new MidiNote(MidiNote.PianoNote.G, 4, 9700), 0d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.G, 4, 9750), 5.7d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.G, 4, 9850), 11.4d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.G, 4, 9950), 17.1d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.E, 4, 10200), 22.8d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.F, 4, 10250), 28.5d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.G, 4, 10350), 34.2d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.F, 4, 10500), 39.9d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.E, 4, 10550), 45.6d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.D, 4, 10650), 51.3d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.DFlat, 4, 10750), 57d),

				Tuple.Create(new MidiNote(MidiNote.PianoNote.D, 4, 11000), 0d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.E, 4, 11050), 11.4d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.F, 4, 11250), 22.8d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.F, 4, 11350), 34.2d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.F, 4, 11500), 45.6d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.F, 4, 11550), 57d),

				Tuple.Create(new MidiNote(MidiNote.PianoNote.F, 4, 12050), 0d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.F, 4, 12150), 11.4d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.F, 4, 12300), 22.8d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.F, 4, 12350), 34.2d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.E, 4, 12400), 45.6d),
				Tuple.Create(new MidiNote(MidiNote.PianoNote.D, 4, 12450), 57d),
			};

			var colors = new List<int> { 0x100000, 0x101000, 0x100010, 0x001000, 0x001010, 0x000010 };
			var notes = beats.Select(beat => beat.Item1.NoteValue).Distinct().OrderByDescending(x => x).ToList();
			var pos = Enumerable.Range(0, notes.Count).ToDictionary(index => notes[index], index => index * (97 - Size) / (notes.Count - 1));
			var segment = new Segment();
			double curX = -1, curY = -1;
			for (var beatCtr = 0; beatCtr < beats.Count; ++beatCtr)
			{
				var beatEndTime = beatCtr + 1 < beats.Count ? beats[beatCtr + 1].Item1.StartTime : SegmentEndTime;
				var beat = beats[beatCtr].Item1;
				var newX = beats[beatCtr].Item2;
				var newY = pos[beat.NoteValue];
				if (curX == -1)
					curX = newX;
				if (curY == -1)
					curY = newY;
				for (var time = 0; time <= BeatMoveTime; ++time)
				{
					var percent = (double)time / BeatMoveTime;
					var x = (newX - curX) * percent + curX;
					var y = (newY - curY) * percent + curY;
					var useTime = beat.StartTime - BeatMoveBefore + time;
					var endTime = time == BeatMoveTime ? int.MaxValue : useTime + FadeTime;
					var center = new Point(x + Size / 2, y + Size / 2);
					foreach (var light in bodyLayout.GetAllLights())
						if ((bodyLayout.GetLightPosition(light) - center).Length <= Size / 2 + .5)
							segment.AddLight(light, useTime, endTime, Helpers.GradientColor(colors[beatCtr % colors.Count], colors[(beatCtr + 1) % colors.Count], percent), 0x000000);
				}
				curX = newX;
				curY = newY;
			}
			return segment;
		}

		class MovingLine
		{
			public Point Center { get; set; }
			public int StartTime { get; set; }
			public int EndTime { get; set; }
			public double StartAngle { get; set; }
			public double EndAngle { get; set; }
		}

		Segment MovingLines()
		{
			const int Width = 4;
			const int PauseTime = 45;

			var segment = new Segment();
			var lines = new List<MovingLine>
			{
				new MovingLine { Center = new Point(48, 48), StartTime = 0, EndTime = PauseTime, StartAngle = 0, EndAngle = 0 },
				new MovingLine { Center = new Point(48, 48), StartTime = 0, EndTime = PauseTime, StartAngle = 90, EndAngle = 90 },

				new MovingLine { Center = new Point(48, 48), StartTime = PauseTime, EndTime = 90, StartAngle = 0, EndAngle = 45 },
				new MovingLine { Center = new Point(48, 48), StartTime = PauseTime, EndTime = 90, StartAngle = 90, EndAngle = 135 },

				new MovingLine { Center = new Point(29, 29), StartTime = 90 + PauseTime, EndTime = 180, StartAngle = 135, EndAngle = 180 },
				new MovingLine { Center = new Point(67, 67), StartTime = 90 + PauseTime, EndTime = 180, StartAngle = 135, EndAngle = 180 },
				new MovingLine { Center = new Point(67, 29), StartTime = 90 + PauseTime, EndTime = 180, StartAngle = 45, EndAngle = 90 },
				new MovingLine { Center = new Point(29, 67), StartTime = 90 + PauseTime, EndTime = 180, StartAngle = 45, EndAngle = 90 },

				new MovingLine { Center = new Point(29, 29), StartTime = 180 + PauseTime, EndTime = 270, StartAngle = 0, EndAngle = 45 },
				new MovingLine { Center = new Point(67, 67), StartTime = 180 + PauseTime, EndTime = 270, StartAngle = 0, EndAngle = 45 },
				new MovingLine { Center = new Point(67, 29), StartTime = 180 + PauseTime, EndTime = 270, StartAngle = 90, EndAngle = 135 },
				new MovingLine { Center = new Point(29, 67), StartTime = 180 + PauseTime, EndTime = 270, StartAngle = 90, EndAngle = 135 },

				new MovingLine { Center = new Point(10, 48), StartTime = 270 + PauseTime, EndTime = 360, StartAngle = 45, EndAngle = 90 },
				new MovingLine { Center = new Point(86, 48), StartTime = 270 + PauseTime, EndTime = 360, StartAngle = 45, EndAngle = 90 },
				new MovingLine { Center = new Point(48, 10), StartTime = 270 + PauseTime, EndTime = 360, StartAngle = 135, EndAngle = 180 },
				new MovingLine { Center = new Point(48, 86), StartTime = 270 + PauseTime, EndTime = 360, StartAngle = 135, EndAngle = 180 },

				new MovingLine { Center = new Point(10, 48), StartTime = 360 + PauseTime, EndTime = 450, StartAngle = 90, EndAngle = 135 },
				new MovingLine { Center = new Point(86, 48), StartTime = 360 + PauseTime, EndTime = 450, StartAngle = 90, EndAngle = 135 },
				new MovingLine { Center = new Point(48, 10), StartTime = 360 + PauseTime, EndTime = 450, StartAngle = 0, EndAngle = 45 },
				new MovingLine { Center = new Point(48, 86), StartTime = 360 + PauseTime, EndTime = 450, StartAngle = 0, EndAngle = 45 },

				new MovingLine { Center = new Point(29, 29), StartTime = 450 + PauseTime, EndTime = 540, StartAngle = 45, EndAngle = 90 },
				new MovingLine { Center = new Point(67, 67), StartTime = 450 + PauseTime, EndTime = 540, StartAngle = 45, EndAngle = 90 },
				new MovingLine { Center = new Point(67, 29), StartTime = 450 + PauseTime, EndTime = 540, StartAngle = 135, EndAngle = 180 },
				new MovingLine { Center = new Point(29, 67), StartTime = 450 + PauseTime, EndTime = 540, StartAngle = 135, EndAngle = 180 },

				new MovingLine { Center = new Point(29, 29), StartTime = 540 + PauseTime, EndTime = 630, StartAngle = 90, EndAngle = 135 },
				new MovingLine { Center = new Point(67, 67), StartTime = 540 + PauseTime, EndTime = 630, StartAngle = 90, EndAngle = 135 },
				new MovingLine { Center = new Point(67, 29), StartTime = 540 + PauseTime, EndTime = 630, StartAngle = 0, EndAngle = 45 },
				new MovingLine { Center = new Point(29, 67), StartTime = 540 + PauseTime, EndTime = 630, StartAngle = 0, EndAngle = 45 },

				new MovingLine { Center = new Point(48, 48), StartTime = 630 + PauseTime, EndTime = 720, StartAngle = 45, EndAngle = 90 },
				new MovingLine { Center = new Point(48, 48), StartTime = 630 + PauseTime, EndTime = 720, StartAngle = 135, EndAngle = 180 },

				new MovingLine { Center = new Point(48, 0), StartTime = 720 + PauseTime, EndTime = 900, StartAngle = 90, EndAngle = 180 },
				new MovingLine { Center = new Point(0, 48), StartTime = 720 + PauseTime, EndTime = 900, StartAngle = 0, EndAngle = 90 },
				new MovingLine { Center = new Point(96, 48), StartTime = 720 + PauseTime, EndTime = 900, StartAngle = 0, EndAngle = 90 },
				new MovingLine { Center = new Point(48, 96), StartTime = 720 + PauseTime, EndTime = 900, StartAngle = 90, EndAngle = 180 },
				new MovingLine { Center = new Point(48, 48), StartTime = 720 + PauseTime, EndTime = 900, StartAngle = 0, EndAngle = 90 },
				new MovingLine { Center = new Point(48, 48), StartTime = 720 + PauseTime, EndTime = 900, StartAngle = 90, EndAngle = 180 },

				new MovingLine { Center = new Point(0, 0), StartTime = 900, EndTime = 1080, StartAngle = 0, EndAngle = 0 },
				new MovingLine { Center = new Point(96, 0), StartTime = 900, EndTime = 1080, StartAngle = 90, EndAngle = 90 },
				new MovingLine { Center = new Point(96, 96), StartTime = 900, EndTime = 1080, StartAngle = 0, EndAngle = 0 },
				new MovingLine { Center = new Point(0, 96), StartTime = 900, EndTime = 1080, StartAngle = 90, EndAngle = 90 },

				new MovingLine { Center = new Point(48, 48), StartTime = 900, EndTime = 1080, StartAngle = 90, EndAngle = 180 },
				new MovingLine { Center = new Point(48, 48), StartTime = 900, EndTime = 1080, StartAngle = 0, EndAngle = 90 },
			};

			var center = new Point(48, 48);
			var lightDistance = bodyLayout.GetAllLights().ToDictionary(light => light, light => (((bodyLayout.GetLightPosition(light) - center).Length - 9) * 16.9830463869911).Round());
			var lightColor = new LightColor(0, 1000, new List<int> { 0x101010 }, new List<int> { 0x000010, 0x101010, 0x000010 }, new List<int> { 0x001000, 0x101010, 0x001000 }, new List<int> { 0x100000, 0x101010, 0x100000 }, new List<int> { 0x100808, 0x081008, 0x080810 }, new List<int> { 0x100010, 0x001010, 0x100010, 0x001010, 0x100010 });
			var maxTime = lines.Max(line => line.EndTime);
			for (var time = 0; time <= maxTime; ++time)
			{
				var first = true;

				foreach (var line in lines)
				{
					if ((time < line.StartTime) || (time > line.EndTime))
						continue;

					if (first)
					{
						segment.Clear(time);
						first = false;
					}

					foreach (var light in bodyLayout.GetAllLights())
					{
						var point = bodyLayout.GetLightPosition(light);
						var useAngle = (((double)time - line.StartTime) / (line.EndTime - line.StartTime) * (line.EndAngle - line.StartAngle) + line.StartAngle) * Math.PI / 180;
						var sin = Math.Sin(useAngle);
						var cos = Math.Cos(useAngle);
						var t = (line.Center.Y - point.Y) * sin - (line.Center.X - point.X) * cos;
						var dist = Math.Sqrt(Math.Pow(t * cos + line.Center.X - point.X, 2) + Math.Pow(-t * sin + line.Center.Y - point.Y, 2)).Round();
						if (dist < Width / 2)
							segment.AddLight(light, time, lightColor, lightDistance[light]);
					}
				}
			}
			return segment;
		}

		Segment RotateSquares()
		{
			var center = new Point(48, 48);
			var segment = new Segment();
			var lightColor = new LightColor(0, 2, new List<int> { 0x101010, 0x101010, 0x101010 }, new List<int> { 0x101010, 0x100000, 0x101010 }, new List<int> { 0x100000, 0x101000, 0x000010 }, new List<int> { 0x100010, 0x000010, 0x001010 });
			for (var angle = 0; angle < 360; ++angle)
			{
				segment.Clear(angle);
				var radians = angle * Math.PI / 180;
				var cos1 = Math.Cos(-radians);
				var cos2 = Math.Cos(radians);
				var sin1 = Math.Sin(-radians);
				var sin2 = Math.Sin(radians);

				foreach (var light in bodyLayout.GetAllLights())
				{
					var point = bodyLayout.GetLightPosition(light) - center;
					var point1 = new Point(Math.Abs((point.X * cos1 - point.Y * sin1).Round()), Math.Abs((point.X * sin1 + point.Y * cos1).Round()));
					var point2 = new Point(Math.Abs((point.X * cos2 - point.Y * sin2).Round()), Math.Abs((point.X * sin2 + point.Y * cos2).Round()));

					var add = -1;

					// Outer square
					if ((point1.X >= 0) && (point1.X <= 48) && (point1.Y >= 47) && (point1.Y <= 48))
						add = 0;
					if ((point1.Y >= 0) && (point1.Y <= 48) && (point1.X >= 47) && (point1.X <= 48))
						add = 0;

					// Middle square
					if ((point2.X >= 0) && (point2.X <= 29) && (point2.Y >= 28) && (point2.Y <= 29))
						add = 1;
					if ((point2.Y >= 0) && (point2.Y <= 29) && (point2.X >= 28) && (point2.X <= 29))
						add = 1;

					// Inner square
					if ((point1.X >= 0) && (point1.X <= 10) && (point1.Y >= 9) && (point1.Y <= 10))
						add = 2;
					if ((point1.Y >= 0) && (point1.Y <= 10) && (point1.X >= 9) && (point1.X <= 10))
						add = 2;

					if (add != -1)
						segment.AddLight(light, angle, lightColor, add);
				}
			}
			return segment;
		}

		Segment ColsToRows(out int moveTime, out int stopTime)
		{
			const int PauseTime = 50;
			const int PointCount = 228;
			const string Data =
				"19,20/19,21/19,22/19,23/19,24/19,25/19,26/19,27/19,28/19,29/19,30/19,31/19,32/19,33/19,34/19,35/19,36/19,37/19,38/19,39/19,40/19,41/19,42/19,43/19,44/19,45/19,46/19,47/19,48/19,49/19,50/19,51/19,52/19,53/19,54/19,55/19,56/19,57/19,58/19,59/19,60/19,61/19,62/19,63/19,64/19,65/19,66/19,67/19,68/19,69/19,70/19,71/19,72/19,73/19,74/19,75/19,76/19,77/19,78/19,79/19,80/19,81/19,82/19,83/19,84/19,85/19,86/19,87/19,88/19,89/19,90/19,91/19,92/19,93/19,94/19,95/20,95/21,95/22,95/23,95/24,95/25,95/26,95/27" +
				",95/28,95/29,95/30,95/31,95/32,95/33,95/34,95/35,95/36,95/37,95/38,95/38,94/38,93/38,92/38,91/38,90/38,89/38,88/38,87/38,86/38,85/38,84/38,83/38,82/38,81/38,80/38,79/38,78/38,77/38,76/38,75/38,74/38,73/38,72/38,71/38,70/38,69/38,68/38,67/38,66/38,65/38,64/38,63/38,62/38,61/38,60/38,59/38,58/38,57/38,56/38,55/38,54/38,53/38,52/38,51/38,50/38,49/38,48/38,47/38,46/38,45/38,44/38,43/38,42/38,41/38,40/38,39/38,38/38,37/38,36/38,35/38,34/38,33/38,32/38,31/38,30/38,29/38,28/38,27/38,26/38,25/38,24/38,2" +
				"3/38,22/38,21/38,20/38,19/38,18/38,17/38,16/38,15/38,14/38,13/38,12/38,11/38,10/38,9/38,8/38,7/38,6/38,5/38,4/38,3/38,2/38,1/38,0/37,0/36,0/35,0/34,0/33,0/32,0/31,0/30,0/29,0/28,0/27,0/26,0/25,0/24,0/23,0/22,0/21,0/20,0/19,0/19,1/19,2/19,3/19,4/19,5/19,6/19,7/19,8/19,9/19,10/19,11/19,12/19,13/19,14/19,15/19,16/19,17/19,18/19,19/18,19/17,19/16,19/15,19/14,19/13,19/12,19/11,19/10,19/9,19/8,19/7,19/6,19/5,19/4,19/3,19/2,19/1,19/0,19/0,20/0,21/0,22/0,23/0,24/0,25/0,26/0,27/0,28/0,29/0,30/0,31/0,32/0" +
				",33/0,34/0,35/0,36/0,37/0,38/1,38/2,38/3,38/4,38/5,38/6,38/7,38/8,38/9,38/10,38/11,38/12,38/13,38/14,38/15,38/16,38/17,38/18,38/19,38/20,38/21,38/22,38/23,38/24,38/25,38/26,38/27,38/28,38/29,38/30,38/31,38/32,38/33,38/34,38/35,38/36,38/37,38/38,38/39,38/40,38/41,38/42,38/43,38/44,38/45,38/46,38/47,38/48,38/49,38/50,38/51,38/52,38/53,38/54,38/55,38/56,38/57,38/58,38/59,38/60,38/61,38/62,38/63,38/64,38/65,38/66,38/67,38/68,38/69,38/70,38/71,38/72,38/73,38/74,38/75,38/76,38/77,38/78,38/79,38/80,38/" +
				"81,38/82,38/83,38/84,38/85,38/86,38/87,38/88,38/89,38/90,38/91,38/92,38/93,38/94,38/95,38/95,37/95,36/95,35/95,34/95,33/95,32/95,31/95,30/95,29/95,28/95,27/95,26/95,25/95,24/95,23/95,22/95,21/95,20/95,19/94,19/93,19/92,19/91,19/90,19/89,19/88,19/87,19/86,19/85,19/84,19/83,19/82,19/81,19/80,19/79,19/78,19/77,19/76,19/75,19/74,19/73,19/72,19/71,19/70,19/69,19/68,19/67,19/66,19/65,19/64,19/63,19/62,19/61,19/60,19/59,19/58,19/57,19/56,19/55,19/54,19/53,19/52,19/51,19/50,19/49,19/48,19/47,19/46,19/45" +
				",19/44,19/43,19/42,19/41,19/40,19/39,19/38,19/37,19/36,19/35,19/34,19/33,19/32,19/31,19/30,19/29,19/28,19/27,19/26,19/25,19/24,19/23,19/22,19/21,19/20,19/19,19";
			var lights = Data.Split('/').Select(Point.Parse).Select(point => new List<Point> { point, new Point(95 - point.X, 95 - point.Y) }.SelectMany(p => bodyLayout.GetPositionLights(p, 2, 2)).ToList()).ToList();
			var center = new Point(48, 48);
			var lightDistance = bodyLayout.GetAllLights().ToDictionary(light => light, light => (((bodyLayout.GetLightPosition(light) - center).Length - 10) * 21.7012478066469).Round());

			var lightColor = new LightColor(0, 2000,
				new List<int> { 0x101010, 0x001010, 0x001008, 0x000010, 0x101010, 0x001010, 0x001008, 0x000010, 0x101010 },
				new List<int> { 0x101010, 0x100010, 0x100008, 0x000010, 0x101010, 0x100010, 0x100008, 0x000010, 0x101010 },
				new List<int> { 0x101010, 0x101000, 0x100800, 0x001000, 0x101010, 0x101000, 0x100800, 0x001000, 0x101010 },
				new List<int> { 0x101010, 0x001010, 0x000810, 0x001000, 0x101010, 0x001010, 0x000810, 0x001000, 0x101010 },
				new List<int> { 0x101010, 0x100010, 0x080010, 0x100000, 0x101010, 0x100010, 0x080010, 0x100000, 0x101010 }
			);

			var segment = new Segment();
			moveTime = 0;
			for (var start = 0; start < lights.Count; ++start)
			{
				segment.Clear(moveTime);
				for (var ctr = 0; ctr < PointCount; ++ctr)
					foreach (var light in lights[(start + ctr) % lights.Count])
					{
						var useTime = ((double)moveTime / 554 * 1000 + lightDistance[light]).Round();
						segment.AddLight(light, moveTime, moveTime + 1000, lightColor, useTime, lightColor, useTime + 1000, true);
					}
				if (start % (lights.Count / 2) == 0)
					moveTime += PauseTime;
				else
					++moveTime;
			}

			stopTime = moveTime;
			segment.Clear(stopTime);
			for (var ctr = 0; ctr < PointCount; ++ctr)
				foreach (var light in lights[PointCount + ctr])
				{
					var useTime = ((double)stopTime / 2 / 554 * 1000 + lightDistance[light]).Round();
					segment.AddLight(light, stopTime, stopTime + 1000, lightColor, useTime, lightColor, useTime + 1000, true);
				}
			stopTime += moveTime;

			return segment;
		}

		class FinalePoint
		{
			public Point Point { get; set; }
			public Size MinSize { get; set; }
			public Size MaxSize { get; set; }
			public double Phase { get; set; }
			public int Color { get; set; }

			public FinalePoint(Point point, Size minSize, Size maxSize, double phase, int color)
			{
				Point = point;
				MinSize = minSize;
				MaxSize = maxSize;
				Phase = phase;
				Color = color;
			}
		}

		Segment Finale(out int moveTime, out int dissolveTime)
		{
			const int Pause = 120;

			var finalePoints = new List<FinalePoint>
			{
				new FinalePoint(new Point(48.5, 1), new Size(0, 2), new Size(97, 2), 180, 0),
				new FinalePoint(new Point(48.5, 96), new Size(0, 2), new Size(97, 2), 180, 0),
				new FinalePoint(new Point(1, 48.5), new Size(2, 0), new Size(2, 97), 180, 0),
				new FinalePoint(new Point(96, 48.5), new Size(2, 0), new Size(2, 97), 180, 0),

				new FinalePoint(new Point(48.5, 20), new Size(0, 2), new Size(97, 2), 102.503241, 1),
				new FinalePoint(new Point(48.5, 77), new Size(0, 2), new Size(97, 2), 102.503241, 1),
				new FinalePoint(new Point(20, 48.5), new Size(2, 0), new Size(2, 97), 102.503241, 1),
				new FinalePoint(new Point(77, 48.5), new Size(2, 0), new Size(2, 97), 102.503241, 1),

				new FinalePoint(new Point(48.5, 39), new Size(0, 2), new Size(97, 2), 55.456992, 0),
				new FinalePoint(new Point(48.5, 58), new Size(0, 2), new Size(97, 2), 55.456992, 0),
				new FinalePoint(new Point(39, 48.5), new Size(2, 0), new Size(2, 97), 55.456992, 0),
				new FinalePoint(new Point(58, 48.5), new Size(2, 0), new Size(2, 97), 55.456992, 0),
			};

			var color = new LightColor(0, 1, new List<int> { 0x101010, 0x101010 }, new List<int> { 0x100000, 0x101000 }, new List<int> { 0x001000, 0x081008 }, new List<int> { 0x100010, 0x001010 });

			var segment = new Segment();
			moveTime = 0;
			for (var angle = 0; angle < 360; ++angle)
			{
				segment.Clear(moveTime);
				foreach (var finalePoint in finalePoints)
				{
					var percent = Math.Max(0, Math.Min((-Math.Cos((angle + finalePoint.Phase) / 180d * Math.PI) + 1) / 2, 1));
					var width = (finalePoint.MaxSize.Width - finalePoint.MinSize.Width) * percent + finalePoint.MinSize.Width;
					var height = (finalePoint.MaxSize.Height - finalePoint.MinSize.Height) * percent + finalePoint.MinSize.Height;
					foreach (var light in bodyLayout.GetPositionLights(finalePoint.Point.X - width / 2, finalePoint.Point.Y - height / 2, width, height))
						segment.AddLight(light, moveTime, color, finalePoint.Color);
				}
				if (angle == 0)
					moveTime += Pause;
				else
					++moveTime;
			}

			dissolveTime = moveTime;
			var rand = new Random(0xbadbeef);
			foreach (var light in bodyLayout.GetAllLights().OrderBy(x => rand.Next()))
				segment.AddLight(light, dissolveTime++, 0x000000);

			return segment;
		}

		public override Song Render()
		{
			var song = new Song("tinylove.ogg");

			song.AddMeasure(1000); // Empty lead-in time
			song.AddMeasure(670); // Pickup
			song.AddMeasure(2266, 15);
			song.AddMeasure(1678, 34);
			song.AddMeasures(2517, 839, 2631, 2631, 3122, 3031, 2975, 2789, 2809, 2746, 2822, 2758, 2801, 2863, 2821, 2929, 2830, 2863, 2851, 3003, 2865, 2847, 2779, 2839, 2655, 2655, 3211, 3302, 3160, 3213, 3582, 3324, 3606, 3204, 3352, 3373, 3365, 3681, 3274, 3352, 1846, 4073, 2842, 2629, 2302, 2485, 2515, 2467, 3270, 3000, 2000);

			// Shift (2)
			var shift = Shift(out var shiftTime);
			song.AddSegment(shift, 0, shiftTime, 2, 1, 8);
			song.AddPaletteChange(0, 0);
			song.AddPaletteChange(1.25373134328358, 2.22065313327449, 1);
			song.AddPaletteChange(3.77934686672551, 4.22065313327449, 2);
			song.AddPaletteChange(5.77934686672551, 6.22065313327449, 3);
			song.AddPaletteChange(7.77934686672551, 8.22065313327449, 4);
			song.AddPaletteChange(10, 0);

			// Runners (10)
			var runners = Runners();
			song.AddSegment(runners, 0, 2800, 10, 7);
			song.AddPaletteChange(10, 0);
			song.AddPaletteChange(11.7793468667255, 12.2206531332745, 1);
			song.AddPaletteChange(14.7793468667255, 15.2206531332745, 2);

			song.AddSegment(runners, 2800, 4400, 17, 4);
			song.AddPaletteChange(16.7793468667255, 17.2979737783075, 3);
			song.AddPaletteChange(21, 0);

			// LineStop (21)
			var lineStop = LineStop();
			song.AddSegment(lineStop, 0, 970 + 100, 21, 14);

			// Heart (35)
			var heart = Heart();
			song.AddSegment(heart, 0, 78, 35, 2, 5);
			song.AddPaletteChange(35, 0);
			song.AddPaletteChange(36.880810488677, 37.119189511323, 1);
			song.AddPaletteChange(38.880810488677, 39.119189511323, 2);
			song.AddPaletteChange(40.880810488677, 41.119189511323, 3);
			song.AddPaletteChange(42.880810488677, 43.119189511323, 4);
			song.AddPaletteChange(45, 0);

			// PointLines (45)
			var pointLines = PointLines(out int pointLinesLength);
			song.AddSegment(pointLines, 0, pointLinesLength * 4 / 5, 45, 8);
			song.AddSegmentByVelocity(pointLines, pointLinesLength * 4 / 5, pointLinesLength, pointLinesLength / 5, 96068, 5262, pointLinesLength / 5, 0, 5261);
			song.AddPaletteChange(45, 0);
			song.AddPaletteChange(47, 1);
			song.AddPaletteChange(49, 2);
			song.AddPaletteChange(50, 3);
			song.AddPaletteChange(51, 4);
			song.AddPaletteChange(52, 5);
			song.AddPaletteChange(55, 0);

			// MoveMelody (55)
			var moveMelody = MoveMelody();
			song.AddSegment(moveMelody, 0, 800, 55, 1);
			song.AddSegment(moveMelody, 800, 1600, 56, 1);
			song.AddSegment(moveMelody, 1600, 2400, 57, 1);
			song.AddSegment(moveMelody, 2400, 3200, 58, 1);
			song.AddSegment(moveMelody, 3200, 4000, 59, 1);
			song.AddSegment(moveMelody, 4000, 4800, 60, 1);
			song.AddSegment(moveMelody, 4800, 5600, 61, 1);
			song.AddSegment(moveMelody, 5600, 6400, 62, 1);
			song.AddSegment(moveMelody, 6400, 7200, 63, 1);
			song.AddSegment(moveMelody, 7200, 8000, 64, 1);
			song.AddSegment(moveMelody, 8000, 8800, 65, 1);
			song.AddSegment(moveMelody, 8800, 9600, 66, 1);
			song.AddSegment(moveMelody, 9600, 10400, 67, 1);
			song.AddSegment(moveMelody, 10400, 11200, 68, 1);
			song.AddSegment(moveMelody, 11200, 12000, 69, 1);
			song.AddSegment(moveMelody, 12000, 12800, 70, 1);

			// MovingLines (71)
			var movingLines = MovingLines();
			song.AddSegment(movingLines, 0, 180, 71, 1);
			song.AddSegment(movingLines, 180, 360, 72, 1);
			song.AddSegment(movingLines, 360, 540, 73, 1);
			song.AddSegment(movingLines, 540, 720, 74, 1);
			song.AddSegment(movingLines, 720, 900, 75, 1);
			song.AddSegment(movingLines, 900, 1080, 76, 1);
			song.AddPaletteChange(71, 0);
			song.AddPaletteChange(71.9301919720768, 72.0702493853179, 1);
			song.AddPaletteChange(72.9297506146821, 73.0719683339331, 2);
			song.AddPaletteChange(73.9280316660669, 74.0704473406129, 3);
			song.AddPaletteChange(74.9295526593871, 75.075329566855, 4);
			song.AddPaletteChange(75.924670433145, 76.075329566855, 5);
			song.AddPaletteChange(77, 0);

			// RotateSquares (77)
			var rotateSquares = RotateSquares();
			song.AddSegment(rotateSquares, 0, 180, 77, 1);
			song.AddSegment(rotateSquares, 0, 180, 78, 1);
			song.AddSegment(rotateSquares, 0, 180, 79, 1);
			song.AddSegment(rotateSquares, 0, 180, 80, 1);
			song.AddSegment(rotateSquares, 0, 180, 81, 1);
			song.AddSegment(rotateSquares, 0, 180, 82, 1);
			song.AddSegment(rotateSquares, 0, 180, 83, 1);
			song.AddPaletteChange(77, 0);
			song.AddPaletteChange(78.9394306480921, 79.0632911392405, 1);
			song.AddPaletteChange(80.9377528789293, 81.0558347292016, 2);
			song.AddPaletteChange(82.9398315282792, 83.0554631170272, 3);
			song.AddPaletteChange(84, 0);

			// ColsToRows (84)
			var colsToRows = ColsToRows(out var colsToRowsMoveTime, out var colsToRowsStopTime);
			song.AddSegment(colsToRows, 0, colsToRowsMoveTime, 84, 1);
			song.AddSegment(colsToRows, 0, colsToRowsMoveTime, 85, 1);
			song.AddSegment(colsToRows, 0, colsToRowsMoveTime, 86, 1);
			song.AddSegment(colsToRows, 0, colsToRowsMoveTime, 87, 1);
			song.AddSegment(colsToRows, 0, colsToRowsMoveTime, 88, 1);
			song.AddSegment(colsToRows, 0, colsToRowsMoveTime, 89, 1);
			song.AddSegment(colsToRows, 0, colsToRowsMoveTime, 90, 1);
			song.AddSegment(colsToRows, 0, colsToRowsMoveTime / 2, 91, 1);
			song.AddSegment(colsToRows, colsToRowsMoveTime, colsToRowsStopTime, 92, 1);
			song.AddPaletteChange(84, 0);
			song.AddPaletteChange(85.9403341288783, 86.0592943966795, 1);
			song.AddPaletteChange(87.9405646359584, 88.054333061668, 2);
			song.AddPaletteChange(89.9389126450825, 90.0596658711217, 3);
			song.AddPaletteChange(91.8916576381365, 92.0491038546526, 4);
			song.AddPaletteChange(93, 0);

			// Finale (93)
			var finale = Finale(out var finaleMoveTime, out var finaleDissolveTime);
			song.AddSegment(finale, 0, finaleMoveTime, 93, 1);
			song.AddSegment(finale, 0, finaleMoveTime, 94, 1);
			song.AddSegment(finale, 0, finaleMoveTime, 95, 1);
			song.AddSegment(finale, 0, finaleMoveTime, 96, 1);
			song.AddSegment(finale, 0, finaleMoveTime, 97, 1);
			song.AddSegment(finale, 0, finaleMoveTime, 98, 1);
			song.AddSegment(finale, 0, finaleMoveTime, 99, 1);
			song.AddSegment(finale, 0, 0, 100, 1);
			song.AddSegment(finale, finaleMoveTime, finaleDissolveTime, 101, 1);
			song.AddPaletteChange(93, 0);
			song.AddPaletteChange(94.923925446938, 95.0868809730669, 1);
			song.AddPaletteChange(96.9195171026157, 97.0795228628231, 2);
			song.AddPaletteChange(98.9189298743413, 99.0611620795107, 3);
			song.AddPaletteChange(102, 0);

			return song;
		}
	}
}
